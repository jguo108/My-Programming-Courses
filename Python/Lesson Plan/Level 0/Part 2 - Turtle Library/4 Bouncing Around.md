# 4 Bouncing Around

### Reference

### Code

### Key Points

- Turtle Module
    - border check and bounce using ‘xcor’ and ‘ycor’
    - bind keys to functions using “onkey” and “listen”
    - use an image for background with “bgpic”
    - check background image size and adjust window size for it
    - how to find all the keys you can bind function to
    - move a turtle in the window continuously
- Programming Concepts
    - Program states and use variable to represent that
    - End program based on state
    - Complex condition using “or”

| Steps | Notes |
| --- | --- |
| Introduction | * Ok, welcome back everyone! Welcome to a brand new lesson! In today’s lesson, we are going to dive deep into the ocean to watch a jellyfish bouncing around. The jellyfish is going to move freely in the window and whenever touching the edge, it bounces back, and this just continues forever, until you are bored and decide to close the window all together. Ok, this might not seem too exciting on the surface. But trust me, everything you learn in this lesson are going to be super important later on when we start to build full games in turtle. Now let's buckle down and get ready for the fun ride! |
| Boilerplate turtle co | * Ok, at the end of the last lesson, I ask you to complete a very important exercise on your own. I asked you to find a sequence of images (TODO: the image must be gif file. I should mention that in the last lesson) of something, could be a person, an animal or just some object, and then apply what we have learnt to create a never ending animation for it. I have seen all of your submissions and they look absolutely amazing! Well done everyone! But while you guys were working on that exercise, I have also created an animation of my own. I have chosen a jellyfish and created an animation to make it look like as if it is swimming. So today, I’m gonna show you how it is done first. This is not going to be very different from the face animation in the last the lesson or any of your exercise. So we will just go through it quickly and then move on to some more exciting new topics. Ok? Let’s begin!

* Again, we start from a completely empty file. Import the turtle module. Define two variables “window_witdth” and “window_height”, set both to 800. So the window is going to be an 800 by 800 square. Then define a new variable called “window” and use the “Screen” method to create a screen object and assign it to “window”.  Next, define a function called “setup_window”. Inside the function, call “title” method on “window” to set the title to “Bouncing Around”. Call “setup” method to set the window width and height. Finally, call “bgclor” to set the background color “black” for now. Once this function is defined, call “setup_window” and finally call “mainloop” method on “window” to keep the window open. Right, I have done this pretty quickly because you should be fairly familiar with all these boilerplate turtle code by now. Let’s run it!

* Test. Yep, we have seen an 800 by 800 window filled with black. And the title is “Bouncing Around”. Cool! |
| Create jellyfish | * Now the scene is set, let’s add our character, the jellyfish. 

* First, define a new variable called “jellyfish”. Then call the “Turtle” method in the turtle module and assign the returned turtle object to “jellyfish”. Next create a new function called “setup_jellyfish”. Inside the function, the first thing we want to do is to give it a costume by calling the “shape” method on “jellyfish”. For the jellyfish, I have prepared 6 costumes, numbered from 1 to 6 in the “Resources/Jellyfish” folder. For now, let’s just use the first costume. So the path string to “1.gif” is “Resources/Jellyfish/1.gif” and we pass that to the “shape” method. Then just call the “penup” method to make sure it does not draw any lines at it moves around in the window. That’s all we need to do in this function for now. Finally, call “setup_jellyfish” after setting up the window. Let’s test the code!

* Test. Ok, cool, we have a jellyfish at the center of the stage, looks pretty nice! Again,  I went through all the code here pretty quickly because we have seen it all in the last lesson and you also had the chance to practice writing it as part of the exercise. |
| Animate jellyfish | * Right, now the jellyfish looks like a specimens in a museum because it is not moving at all. Let’s add some animation to make it become alive! Again, this is going to be very similar to what we have done for the face animation in the last lesson. So let’s just quickly go through that.

* First we define a variable “num_of_jellyfish_costumes” and assign 6 to it, because we have 6 costumes. Then define a list called “jellyfish_costumes” to store the path strings for all 6 costumes. Then in function “setup_jellyfish”, we would like to first add all costumes’ path strings to the window so that they can be used later on when animating the jellyfish. So let’s do “for”, loop variable “i”, “in” then “range” and pass “num_of_jellyfish_costumes” as argument. In the “for” loop, create a local variable call “path” and then assign the path f-string to it. The f-string uses the loop variable “i” to make sure a different costume is picked for each loop iteration. Then it’s just adding that costume to both the window by calling “addshape” and the “jellyfish_costumes” list by calling “append”, passing “path” as argument to both function calls. Cool, now all the costumes have been prepared and it’s time for some animation.

* From the last lesson, we know two ways to animate a character in turtle, we can either use a forever loop to cycle through each costume or we can use the “event-based” approach to switch to a new costume each time an event happens, and doing this at regular time interval, non stop. I have also explained in detail the downside of the forever loop approach. And in fact, we should almost always use the event-based approach whenever possible. And that’s what we are going to do here.

* So let’s create another function called “switch_jellyfish_costume”. This is the event handler that is going to be run whenever an event happens, and it just changes the jellyfish’s costume to a new one. For that, we need a global list index “i”, so let’s define that in the global scope and assign 0 as the initial value. Then inside function “switch_jellyfish_costume”, first declare variable “i” as global because it is going to be updated here. Then check if “i” has already pass the last costume by checking if it is equal to “num_of_jellyfish_costuems”, and if so, reset it back to 0. After that, switch to a new costume for the jellyfish by calling the “shape” method. It’s argument is the path to the costume, which can be obtained by indexing the “jellyfish_costumes” list with index variable “i”. After than, increment “i” by one. Finally, we need to schedule the event again by calling “ontimer” on the window. The first argument is going to be the name of this function, because that is what we want to do when an event happens. The second argument is the time interval between events, in milliseconds. So let’s try 500 milliseconds, that is half of second. Finally, don’t forget to call “switch_jellyfish_costume” after it is created. (TODO: maybe it is a better idea to call this inside “se_jellyfish”? And same for the face animation?). Let’s run the code!

* Test. Wow, our jellyfish is no longer like a specimens in a museum! It’s actually moves! Pretty cool! But I think the animation could be made a bit faster and smoother. So let’s change the time interval for “ontimer” to 200 milliseconds, so it waits shorter before switching to the next costume. Let’s try again. Yeah, I think this looks better, let’s leave it at 200 milliseconds. Nice! |
| Use an image for background | * Ok, so far in all of our turtle projects, we have been using a single color background for window. This is ok for simple projects, but for more complex animations or games, you often want a more interesting background to set the scene. For example, since we have a jellyfish here, so naturally I want the scene to be set deep in the ocean. This means I would probably need an underwater image as my background. You can search and find a lot of such images on the internet. I have already prepare one for this lesson and it is in the “Resources/Background” folder. The file is just called “background.gif”. If you open this up you would see a pretty beautiful underwater image. With a cave, some corrals and even some other jellyfish in the backdrop. Looks perfect! So let’s see how to use this for our window background.

* Since this is going to be part of the window setup, let’s go back to the “setup_window” function. Currently, we just call “bgcolor” method on the window to set a black background. Now, to use an image for the background instead, we call a different method named “bgpic”, short or “background picture”, on the window. This method accepts one parameter, can you guess that that would be? Yes, it is the path to the background image file. So what is the path? Yes, it’s “Resources/Background/background.gif”. Ok, let’s test this!

* Test. Right, we now see the underwater image as our background now. But there is a small issue. Remember the size of our window? Yes, it’s an 800x800 square. But the image has a portrait orientation, meaning its height is longer than its width, it’s a rectangle. As a result, we are seeing the big width area on both sides. So how can we remove them? Well, we can just make the window the same size as the image, then it should fit in nicely. To do this, we first need to figure out what is the exact size of the image. Go in find this image on your computer. To locate it more quickly, you can hover your mouse over the “background.gif” image in VS code, right click, in the menu that pops up, select “Reveal in File Explorer”. The VS Code is going to open up the folder that contains this image file. Now, again, right click on the image file, in the menu that pops up, select the last one “Properties”, and the small window of that file shows up. There are a few tabs at the top, the one we are interested in the third one called “Detail information”, click that, and this show all information about this file. Here you can see the exact size of this image, so it’s 600x800, the height is 800 and the width is 600. Right, with this size information, we can adjust our window size in the code. All we need to do is assign 600 rather than 800 to “window_width” when it is first defined. Let’s run the code again.

* Test. Yes, this time the window is also 600x800 and the image now fits in perfectly! Nice! |
| Start jellyfish at random locations | * Right now, the jellyfish always starts at the same center position. The next small change I want to make is to introduce some randomness so that the jellyfish starts at a different position each time we run the program. 

* We have seen something similar in the Modern Art lesson, where we draw a shape at a randomly picked position each time. The idea here is not very different from that. First thing, we need to import the random module. So go to the top of the file and type in <import random>. Then inside “setup_jellyfish” function, we want it to start at a random position. This can be done by calling the “goto” method on jellyfish. The first argument is the position’s x coordinate. Since the width of our window is 600, the range of x coordinates we can randomly pick from is -300 to 300. So we call “randint” method in the random module, the minimum value of the range is minus “window_width” divided by 2 and the maximum value of the range is just “window_width” divided by 2. Ok, everybody ok with that? Cool. The second argument is the position’s y coordiante. Since the height of our window is 800, the range of y coordinates we can randomly pick from is -400 to 400. So let’s call “randint” again, this time, the minimum value of the range is minus “window_height” divided by 2 and the maximum value of the range is just “window_height” divided by 2. Let’s test this.

Test. Ok, we are going to run this a couple of times and see if the jellyfish starts at different positions each time. Ok, so it does seem to go to a random position to start. But there is a small issue, we can always see it move from the center to the random position. Ideally, we just want the jellyfish to be at the random position right from the start. Does anyone know why we see it moving? Yes, because we have not set the speed of it. To fix it, we just need to make the turtle move as fast as possible by calling the “speed” method and pass 0 as argument. Now let’s test it again! Yeah, this time, the jellyfish starts at the random position right from the beginning, we no longer see it move from the center any more! Cool! But if we run it a few more times, we can see that some times, the jellyfish is just too close to the window edge that part of it is outside the window. We had a similar issue with the shape in the Modern Art lesson, right? What did we do to solve this problem? Yes, we created a smaller area inside the window where the random starting positions can be picked from. How did we do that? Yes, we just set a border around the window. So let’s defined a new variable called “border_width” and set it to 100. So the border is going to be 100 pixels wide. Then, when we pick a random position here, let’s shrink both x and y ranges by adding “border_width” to the minimum values and substracting “border_width” from the maximum values. Let’s run the code a few more times, now, the jellyfish never starts at the edge of the window. Cool! |
| Move jellyfish | * OK, it’s time to make our jellyfish move! Basically, we want it to move in a certain direction a number of steps each time. As soon as it touches a window edge, it bounces back and then moves in a new direction until it hits another edge. This just continues forever, until the game ends. Sounds like a forever game loop, right?

* Ok, we know what a game loop looks like, it is just a “while True” loop. Inside the loop, want to move the jellyfish a number of steps during each iteration. So let’s call the “forward” method on “jellyfish”. Now, exactly how many steps to move each time is totally up to you, you can make it faster or slower by passing a bigger or smaller number as argument. I’m just gonna move it 2 steps at a time. So define a new global variable called “jellyfish_speed” and assign 2 to it. Then just pass this variable as argument to “forward”. Let’s run this! 

* Test. Ok, so our jellyfish can move now! As soon as the program starts, it moves to the right until it is completely out of the window. Let’s not worry about that for now, because later on, we are going to check if it touches the edge and bounce it back if so. Here, I want to address a different problem: everytime we run the program, the jellyfish always moves towards right. This is because when a turtle is created, it points to the right by default. So if you don’t change it, it will always be like this. However, just like the random starting positions, I would also like to introduce some randomness for the jellyfish’s initial direction. Again, this should be part of setting up the jellyfish, so let’s go back to the “setup_jellyfish” function. After it goes to a random starting position, we also want it to point to a random direction as well. So how do we make a turtle point to a certain direction? Do you still remember to method to do it? Yes, the “setheading” method. So let’s call it on “jellyfish”. The argument is the direction we want to point to. Since a full circle has 360 degrees, a random direction is just a random number between 0 and 360. So let’s generate the random direction by calling “randint” and passing 0 and 360 as the minimum and maximum values. Let’s test this out. We are running the program a couple of times, and notice each time, the jelly fish starts to move in a completely different direction. Pretty cool! |
| Collision check | * OK, let’s next look at how to make the jellyfish bounce back once it hits the window edge. To solve this problem, we first need to figure out how do we know if the jellyfish touches an edge or not. Does any one have any good idea? Ok, these are all very good suggestions. 

* Let’s say we can track where the jellyfish is in the window at any time, meaning we can always get its latest x and y coordinates, then by checking these coordinates against the edges, we can determine whether the jellyfish hits the edges or not. For example, the x coordinate of the right edge is 300, because the window width is 600. Now, say the jellyfish keeps moving right, so its x coordinate becomes bigger and bigger. Then eventually, when its x coordinate is greater than or equal to 300, it collides with the right edge. Same with the other directions, if it keeps moving down, its y coordinate is going to become smaller and smaller, until it is smaller than or equal to -400, at which point it collides with the bottom edge. So by simply checking the jellyfish’s current x and y coordinate against the four edges, we can determine if it hits an edge or not. 

* Now, for this to work, the most important piece of information we need is the jellyfish’s current x and y coordinates. Fortunately, they are not hard to get at all. There are two methods named “xcor” and “ycor”, short for “x coordinate” and “y coordinate”, that you can call on a Turtle object to get its current x and y coordinates. So, just to show you how they work, let me print out the jellyfish’s position in the game loop after it has moved forward. So “print”, then pass an f-string, and the two values used in the string are the return values of calling “xcor” and “ycor” on the “jellyfish” object. Now let’s run this.

* Test. Ok, once the program is run, pay attention to the console. You can see the x and y coordinates  being printed again and again. Their values change as the Jellyfish keeps moving around. Cool! Let’s delete this print since it is only used to show how these two methods work.

* Ok, once we have the x and y coordinates, we can check for edge collision, and if that happens, we should bounce the jellyfish back. First, we need an if statement. What is the condition going to be? Well, remember how we check if collision happens using the jellyfish’s x and y coordinates? Let’s turn that into code. First, we check if the x coordinate of the jellyfish is greater than or equal to 300. In code, we call “xcor” method on the jellyfish to get its x coordinate first. And for greater than or equal to, we use this “>=” operator here, which is just a “>” symbol followed by an “=” symbol. If the x coordinate is greater than “window_width” divided by 2, which is just 300, the jellyfish should bounce, right? Currently, let’s not worry about how to make it bounce, so just print “Bouncing back!” in the if statement. 

* Ok, is this enough to check for collision? Of course not! This just checks if the jellyfish hits the right edge, but how about the other three edges? They need to be checked as well, right? Ok, now looks like we are going to have a complex condition made up with multiple sub-conditions. Does anyone still remember how to join multiple sub-conditions together? Yes, we can use logical operators such as “and” or “or”, right? Now, for all the four sub-conditions, each checking collision with one edge, do you think they should be be joined with “and” or “or” operator? First of all, can anyone remind us all what are the differences between these two operators? Go on. Great! So when you use “and” to join sub-conditions together, the whole condition is only True if all sub-conditions are True. As long as one of them is False, the whole condition is False. On contrary, when the sub-conditions are joined using the “or” operator, the whole condition is True if at least one of the sub-condition is True. It is only False if all sub-conditions are False. Now, coming back to the collision check here, do you think a collision happens when the Jellyfish collides with all edges or collides with at least on edge? The second one, of course, right? It is not even possible for the jellyfish to collide with all four edges at the same time! So which logical operator is appropriate here? Yes, the “or” operator. 

* OK, we already have one sub-condition to check for collision with the right edge. Let’s add the other three. So type in “or” after the first sub-condition. The second sub-condition checks if it collides with left edge. So get its x coordinate again by calling “xcor” on “jellyfish”. A collision means its x coordinate is less than or eqaul to -300. So first the less than or equal to operator is a “<” symbol followed by a “=” symbol. Then the left edge is at minus “window_width” divided by 2. Ok, the entire condition is becoming a little bit too long, so we can break it up into two lines, hit return after the “or” operator to move the second sub-condition to the next line. But now, Python is giving you this red line saying this is invalid syntax. So whenever you break an if condition into multiple lines, always remember to add a “\” symbol at the end of each line. This just tells python that the condition continues into the next line. The only exception is the final line, where no “\” is needed. Ok, so both left and right edges are checked. All that’s left is the top and bottom edges. Let’s have a 5 min break and see if you can complete those two sub-conditions yourselves. OK, times up, let’s do it together. For the top edge, the sub-condition is <jellyfish.ycor() >= window_height/2> and for the bottom edge, the sub-condition is <jellyfish.ycor() <= -window_height/2>. See if you get both correct. Now, let’s test the code.

* Test. Ok, now when the jellyfish hits one edge, we start to see message “Bouncing back!” being printed. Of course, this is printed many times, because the jellyfish is not actually bouncing back and it keeps moving forward further and further outside of the window, so for each game loop iteration, the big condition is still True, and the message just keeps being printed. OK, we can run the program a couple of times just to make sure that the code works for each of the four edges. OK, looks like it does work in all cases. Perfect! |
| Bounce back | * OK, we can check for collision now, and the only thing that’s left is to actually bounce the jellyfish back. Now, there are different ways you can bounce an object back when it hits a surface. For example, you could just bounce it back randomly, the object can potentially go in any direction, or you could do what the light does when it hits a surface, that is the incoming angle is the same as the outgoing angle. Some are easier to code and some are slightly more difficult. Here, I don’t want to make it too complicated, I would just make the jellyfish turn around 180 degrees and travel in the exact opposite direction. How do we turn a sprite 180 degrees? Yes, we can use either the “left” or the “right” method and pass 180 degrees to it. Let’s delete the print here and call “left” on “jellyfish” and pass 180. Let’s test the code.

* Test. OK, the jellyfish now turns around whenever it collides with an edge. But if you keep watching it for a bit longer, something seems to be odd: the jellyfish just goes back and forth between two edges along the same path, so it never goes anywhere else. However, we actually want it to bounce around in the window instead. So what went wrong? Now, think about it, whenever the jellyfish hits an edge, it turns around 180 degrees to face the exact opposite direction. As a result, it is going to follow the exact same path back, right? When it hits the other edge again, it is going to turn back and follow the same path again. When why we are seeing the back and forth here. To solve this problem, we can add some randomness when the jellyfish bounces back. So instead of always turning 180 degrees, we add a small amount of deviation, say a random number between -45 and 45. So the actual degree is going to be from 135 to 225. We get 135 by adding -45 to 180 and get 225 by adding 45 to 180. Let’s test this again!

Test. As we can see, the jellyfish will still bounce back, but it is not going face the exact opposite direction. This makes sure it can go to other places in the window and bounce around. Pretty cool! |
| Cleanup | * OK, as you can see, even with an animation as simple as this one can end up with quite a lot of code. As the code grows, it becomes more and more important to keep it well organized. we have been pretty good at doing this by creating a lot of functions to do different things, for example, there is function to setup window, to bind keys and to create jellyfish etc. But now I’m feeling that the game loop is becomes quite big and has a lot of code inside. Maybe it’s time to clean it up a little bit.

* So first, since pretty all animations or game is going to have a game loop, I will create a function called “game_loop” and just move this entire loop inside. Make sure to indent it properly. And then just call this function instead. Now, it important to test to code again after such change to make sure you have not accidentally broken anything.

* Test. Yep, the program still runs nicely.

* Ok, next let’s turn out attention to the inside of the game loop. What are the main tasks of the loop? Ok, I can see three, first one is to check if the animation has been stopped, and the second one is to move the jellyfish and bounce it if needed. So we could potentially create two separate functions for both tasks. But of course, the first task is too simple for a function and I will just leave it as it is. For the second task, let’s create a new function called “move_jellyfish” with no parameters. Then just move the “forward” method call and the “if” statement inside the new function and call it instead. Now, the game loop becomes much easier to understand. With just a quick glance, we can immediately tell that it does two things: check for stop and if not, move the jellyfish. Pretty nice! Let’s test is again to make sure everything still works.

* Test. Yep, looks all good! |
| Stop animation | * Ok, we are pretty much done by now. The jellyfish can not only move around in the window, but also change costumes to make it look as if it as actually swimming. we have also made our code well organized. As we will see later in the course, everything here are very important building blocks for more complex games. But before we finish today’s lesson, there is one more thing I want to do. Currently, when we have watched enough of Jellyfish dance, the only option to stop it is to close the entire window and exit the program. Now, take a look at Scratch again. In the stage area, there is green flag button to start the program, and there is also a red octagon button to stop it. So once the program starts, you can stop everything by clicking just that one button. You don’t have to close the entire Scratch window to do that, right? This is pretty convenient. Ideally, we want to be able to also stop the Jellyfish animation without closing the entire window. Can we do that in Python turtle? Let’s find out!

* First, we need to figure how to stop the animation. There are a couple of different things people can do to stop a program. The most common one is to have a “stop” button to click at anytime to stop everything, like Scratch. Another very common way is to press a key on the keyboard. Keys that are commonly used for this purpose are the Esc key and the space bar. For our program here, since we don’t have any buttons to click on, we are going for the second approach by using the space bar key on the keyboard.

* Ok, this means we are no longer passively watching what the program does, we are now actively interacting with it by pressing keys. In part ONE of this course, we use the Console as the main way to interact with our programs : we type something in, could be the answer to a question or an option selected, and the program reacts to our input accordingly. This is OK for some types of programs, but when it comes to animations and games, it is often not the best way. Just think about how often you type in commands to control the movement of your character, like “go up” or “go right”, not very often, right? Instead, we would ofetn use arrow keys for that. So we are going to press the space key to stop our animation.

* The next question is how does a turtle program knows when a key is pressed? Or how can we detect any key presses? In Scratch, there is a sensing block called “key pressed?” and you can choose the key from a range of common ones. For example, the space key and the four arrows. You can use this block to detect which key has been pressed and then make the sprite react to it accordingly. A common use in Scratch is to detect which arrow key is pressed and move the sprite in that direction. Ok, that is Scratch. How about Python turtle? Can we detect which key is pressed? Of course, we can! Turtle is designed for creating interactive animations and games after all! 

* In Python, to make a program react to key presses, we first need to do what is often called “key binding”. OK, what does that mean? “Binding” means to tie or stick a few things together. So what are the things to tie or stick together here? Well, since it is called “key binding”, then one of those things is a keyboard key, could be the space bar, arrow keys, or anything you like. The other thing to bind together with the key is a function. A function? What function? Well, it can be any function that is user-defined, one that you create to do all the hard work when that key is pressed. And for this reason, this function is also sometimes called a “key handler”, or “event handler” because a key press is also considered a kind of event. Essentially, the binding creates a pair of a key and its handler, they become good buddies! Right, what next then? Why creating such a binding is useful? Well, it is going to be very useful! Once the binding is setup, then whenever the key of that pair is pressed, the key handler function of the pair is called and do all the hard work. This is allowing you to do some pretty amazing things!

* Ok, it’s all just me talking and telling you how cool key binding is. Let’s see some actual code to get better feeling of it. As I said, the first step is to bind a key. Because we want to use the space bar for stopping, we are going to bind the space key. Also, because everything happens inside our window, we are going to call a method on the window for the key binding, and this method is called “onkey”. So, after the window is setup, let’s call “onkey” on the “window” variable. Now, this method accepts two parameters. Can you guess what they are? Yes, the key and the key handler. The first parameter is the key handler and the second one is the key. Let’s not worry too much about the key handler for now, and focus on the actual key that is pressed. In Scratch, a dropdown key list contains all the keys for us to choose from. But there is no such list here in Python turtle, how can we find out all the keys then? Well, you can always find something useful about Python on the internet. [This page](https://www.tcl.tk/man/tcl8.4/TkCmd/keysyms.htm) lists all the keys for you! It is a very long list with three columns, the second and third columns have some funny numbers and let’s not worry too much about those. What is important to us is this first column, where you have the names of each supported key. For example, the first one is just “space”, the exact key we need! How convenient is that! Of course, we are not going to go through the entire list here, that will be crazy! This is only a reference for you to come back and look things up whenever you need to bind to a key and not sure what is its exact name. 

* Ok, we now have the name of the space key, it’s just called “space”, and let’s pass that as the second argument to method “onkey”. Now, let’s focus on the first argument, the key handler. As I said earlier, this is just going to be a user-defined function that is run then the space key is pressed. We haven’t got such a function yet, so let’s create one. What do we want to happen when the space key is pressed? Yes, we want to stop the animation. So I’m going to name this function “stop” without any parameters. Now, this is important, the function you bind to a key cannot have any parameters. Ok, we haven’t figured out know how to stop the animation yet, so let’s just print message “Space key pressed!” for now. This should at least show whether the key binding works. Ok, let’s test this!

* Test. OK, the jellyfish starts moving. Now, if we press the space bar on our keyboard, we should see message “Space key pressed”, right? Let’s try! Press, press, press, and nothing happens? What is going on? Something is missing. OK, let’s explain. Our window is like a very careless person. When you bind the keys, it’s like you are telling him or her that when such key is pressed, you need to do this. This careless person took a note of it and then totally forgot about it afterwards. So what we need to is to get his/her full attention by speaking out loud “You need to listen to those key presses and do the right thing when it happen!”. So in code, we need to call another method named “listen” after binding all the keys. This method has no argument and its purpose is to explicitly tell the window to listen for the keys we have bound. Now, let’s test the code again! If I press the space bar now, see what happen in the console! We see message “Space key is pressed!” It’s printed every time I press the space bar, meaning the key handler function “pause_and_resume” is run each time. Perfect!

* Ok, before we move on, I would like to move the “onkey” and “listen” method calls into a new function. As we will see later on in the course, sometimes we need to bind more than one key. So it’s better to put all the key binding related code in one place. Let me create a function called “bind_keys” with no parameter, then just move these two lines inside this new function. After that, just call “bind_keys” after “setup_window”. 

* Ok, we can now print a message when the space key is pressed. But what we don’t really care about the message itself, it’s just there so that we can show how key binding works. Instead, we want pressing the space key to stop the animation. How can we do that? Let’s think about it. Right now in the game loop, we always move the jellyfish and check if it is colliding with the edge, right? But what we really want is that if the animation is stopped, the jellyfish should not be able to move any more. The entire game loop should end. To do that, we first need to be able to tell if the animation has been stopped in the game loop. Ok, here I would like to introduce the concept of a “state”. The word might sound scary, but it’s everywhere in our lives. One typical example would be the two states a lightbulb can be in: on or off, simple as that. “on” is one state in which the lightbulb is sending out light and heat, and “off” is the other state in which the lightbulb and dark and cool. When the lightbulb is on, flipping a switch turns it off. So it goes from the “on” state to the “off” state. Now, what states do you think out animation can be in? Yes, also two states, “stopped” and “not stopped”. And when it is in the “not stopped” state, meaning the animation is still running, what should happen when you press the space key? Yes, it stops the animation and the jellyfish should not move any more. 

* OK, one of the easiest way to to keep track of state, especially when the state can be only one or the other, is to use a boolean variable. A boolean variable can only have two values, Ture or False, one represents each state. So let me create a variable called “stopped” and assign False to it. This means when the animation starts, it is NOT stopped, or in other words, the animation is running. Now, when the space key is pressed, what do we want to change “stopped” to? Yes, we want to change it to True, so that the animation is stopped. And where should we do that? Yes, in the “stop” key event handler. So let’s change the value of “stopped” to True in the function. Let’s test the code.

* Test. Ok, when we press the space key, we still see the same message, but our jellyfish has not stopped moving. What went wrong here? Yes, even though we set “stopped” to True, but the game loop continues to run and moves the jellyfish! So as I said earlier, when the animation is stopped, we no longer want the game loop to run anymore and it should end, right? So how can you end a game loop, or any forever loop? Yes, we can check if the animation has been stopped and break out of the loop if so. So let’s add an “if” statement. What is condition we want to check? Yes we want to check if “stopped” is True, so that variable is just the if condition. And if it is stopped, we then end the loop by using the “break” statement. So this breaks out of the loop right away. If not, nothing is going to happen and the loop continues with the rest of the code to move the jellyfish.

* Test. Right, let’s run this again. Let’s press space, hmmm… strange, looks like it is the same as before: when pressing the space key, we see the message, but still, the animation continues on. It has not been stopped! Ok, something is still not quite right! If we see the message, then it should mean the key event handler “stop” has been run, and if it has been run, then the “stopped” variable should have been set to True, and if it is set to True then the condition of the “if” statement in the game loop is also True. If the condition is True, then we should break out of loop and everything should stop, right? This all sounds reasonable, but why is it not happening? 

* Ok, to figure out the truth, let’s print variable “stopped” before the if statement just to check if it is indeed True after we have pressed the space key. Let’s run the the code again. Now, when the program starts to run, we see a lot of False being printed in the Console. This makes sense because “stopped” was initially set to False and the game loop is running again and again. Ok, now watch what happen when I press the space. According to our analysis, this should set “stopped” to True and we should see a lot of True being printed in the console, right? OK, press, and we briefly saw message “Space key pressed!” quickly go by then we are seeing a lot of False again! This means, after pressing the space key, variable “paused” still has value False, meaning we have not changed its value at all! And because it is not paused, surely the animation won’t stop. 

* But why? The key handler is clearly run, and why the “stopped” variable has not been set to True? Anyone has any idea? Yes, brilliant! Excellent! Is “stopped” is global variable? Yes, it is. Are we changing the value of a global variable in a function? Yes, we are! So what is missing if you plan to change the value of a global variable in a function? Yes, we need the global keyword at the beginning of the function! So let’s add that! If you don’t that, when you assign Ture to “stopped” here, this “stopped” variable is going to be treated as a local one that just happens to be called “stopped”. It is not the same as the global “stopped” variable. So setting it here won’t change the value of the global “stopped”. And because the game loop can only access the global “stopped” and not the local one, the value it sees is still False. After adding the “global” statement inside the function, you are explicitly telling Python that any “stopped” variable that appear here is referring to the global one, use that and do not create a local “stopped” variable. This is very common mistake people tend to make when they use global variables in a function. Especially if you assign a new value to the global variable, you must have the global statement. Otherwise, it is just creating a local variable that happens to have the same name. So please please, keep this in mind! 

* Test. Ok, let try again after this change.  Now, as we press the space key, the jellyfish stops moving! Excellent! But there is a small issue: even though it is not moving anymore, it’s still changing costumes, so looks like it is still alive. But when we stop an animation or a game, we want all kinds of movement to be stopped. So jellyfish should stopped changing costumes also. Since we are running out of time, I will leave this as an after class exercise for you guys. 

* Ok, we are now able to stop the animation by just pressing one key on the key board. More importantly, we have learnt how to bind functions to keys so that we can use keyboards key to control the program. This is going to be very important for build more interesting games, as we will see in the next lesson. But time is almost up, and we are done for today. Leave all the fun for the next lesson! |

### Exercises

- How to stop the jellyfish from switch costumes when the animation is stopped
- What are the different ways you can make the jellyfish move faster or slower
- Can you make the jellyfish bounce in the same way as light bounces off a surface
- Can you use keys other than space for stopping
- Can you choose two keys key1 and key2, so that when key1 is pressed the jellyfish is shown and when key2 is pressed, it is hidden. Once you get this done, change the code so that it only uses one key, when it is pressed, the jellyfish is hidden if it was visible and shown if it was invisible.