# 6 Ask the Expert

### Reference

“Coding Projects in Python”

### Code

[https://github.com/jguo108/My-Programming-Courses/blob/main/Python/Level0/Basics/6 Ask the Expert/main.py](https://github.com/jguo108/My-Programming-Courses/blob/main/Python/Level0/Basics/6%20Ask%20the%20Expert/main.py)

### Key Points

- Dictionary
    - Create an empty dictionary
    - Check if entry is in dictionary
    - Get value from key
    - Add new pair
- List
    - “count” method
    - “index” method
    - check list membership with “in”
- string
    - immutability
    - “split” method
    - escape character and newline character
- File handling
    - write to file
    - different between file append and write mode
    - file “flush” method

| Steps | Note |
| --- | --- |
| Introduction | * Ok, welcome back, everyone. Welcome to a brand new lesson! So previously, in lesson Animal Quiz, we test the users on their animal knowledge with three questions. As the programmer of that quiz, you can of course add more questions. But there is just so much you can do, maybe because you don’t have the time or you are also limited by your knowledge of animals. Can how can we grow the knowledge base of our quiz system, or any knowledge system more easily?

* Well, there is a commonly used approach called “Crowd Intelligence”. Well, “crowd” here means the public, everybody, the people in the word. So if we can collect all those people’s intelligence gradually, then we can make our knowledge system smarter and better over time. And there are actually a lot of companies using this strategy to improve their products. 

* For example, everybody ever used a language translation tool? Such as google translate? How do you think it is able to translate so many different languages so well? Yes, there are a number of different strategies being used, but one important one is ask for help from the users! For each translation given, users can flag flag it as correct or incorrect and maybe even suggest some improvements, which the translation system then adds into its language base. With more user feedback, the system learns to better understand context, and regional variations in language, making the translation  more accurate.

* Another example is an online map, such as Baidu map or Google map. When your parents drive on the road, they would often use such an app. The app can not only navigate, but also gives you real time information about road closures, accidents and traffic jams. How do you think it knows all that? Well, simple, because there are hundreds of even thousands of other drivers around you at the same time. And if they are also using the same app, it can then figure out all the cars’ speeds, directions etc etc. And based on all these information, the app can then work out the overall traffic condition and give that information to all drivers. Over time, the map becomes more accurate and detailed, offering better route suggestions, estimated travel times, and even finding the quickest alternatives during unexpected traffic disruptions. Another perfect example of crowd intelligence. 

* So in this lesson, we are going to build such a crowd intelligence system that you can use to ask questions about capitals. Let’s first see how it works. When the program starts, it first asks whether you want to learn about capitals or quit. Now, “1” means learn and “2” means quit. So let me type “1” and hit return. Next, it’s going to ask you the name of a country. Let’s say “china” and then it prints “The capital of china is beijing”. Not bad. Then it prints and waits for the next country. This time, let me type in “germany” and hit return. It prints “The capital of germany is berline”. Ok, that’s good. Now, the third time, I want to know what is the capital of the country “kenya” and see how it responds. Aha, looks like we have managed to hit the blind spot of our system, it says “I don’t know the the capital of kenya. Could you tell me?” So this is the crowd intelligence part, the system has now idea about the capital of kenya, neither do I. But I can ask my parents or my friends, someone must know that. And eventually, I figure this out, the capital is “nairobi” . So I will type this in. Now this knowledge then goes into the system. Say later on, when someone else uses the system and asks the capital city of kenya, the system can now reply with “nairobi”! Cool, it learns new things and gets better everyday. Awesome!

* OK, once we have asked enough of questions, we can just quit the system by typing “2” and hit return.
 
* So, there you go, this is the system that knows a lot about capitals and is also willing to learn from us. Sounds exciting? Let’s build this together in this lesson! |
| Prepare data | * First, we want the expert system to know the capitals of some countries to start with. Of course, you can still start it with no knowledge at all, but I won’t be willing to call myself an “expert” in that case. Then let’s think about what the knowledge looks like. It’s basically a collection of word pairs. Each pair is for one country and its capital. For example, if the first word of a pair is “china”, then the second word is “beijing”. OK, the next question is how do we store this knowledge? How do we store all the word pairs? Well, so far, the most common way for us to store a collection of data is List. So can we use use list here? But you might ask, “well, but all the list items we have seen so far are single strings, such as student names and secret words. How can we store a pair of strings?” Well, there are actually ways to store pairs of strings, or pairs of anything, in a list. But let’s stick with storing single strings as items in a list for now. 

* In that case, we can just split all the pairs up, store all the countries in one list and all their capitals in another list. So let create an empty list and assign it to a variable called “countries” and we create another empty list and assign it to a variable called “capitals”. Ok, next, let’s start to add the country-capital pair one by one. The first country is ‘china’, we add it to the “countries” list. Its capital is “beijing” and we add it to the “capitals” list. Next up, the country is “germany” and its capital is “berlin”, we add them to the two lists respectively. And we just do the same for all the rest country-capital pairs. Now, as you can see, there is a one-to-one relationship between the two lists: given a list index, you can find the country in the “countries” list and its capital in the “capitals” list. For example, if the index is 3, meaning the fourth item in both lists, we can find the country “egypt” and its capital “cairo”. Cool. So our expert system now has some basic knowledge to start with. It’s time to help people who want to find out what the capital is for a country! |
| Game loop scaffolding | * Now, from the demonstration at the beginning of this lesson, we can see that program keeps asking us if we want to ask the expert or exit the system. If we want to ask the expert, it then asks us to type in a country name and then gives us its capital if it knows about it. This then starts all over again. Of course, we can choose to quit the system at any time, in which case, the program just ends. 

* Now, in the last lesson, we learnt about “game loop”: it is just a loop that runs forever, each time running some game logic, and if certain conditions are met, such as user winning or losing, the loop stops and the game ends. Now, even though it is called a “game loop”, but that does not mean it can only be used for games. In fact, a loop that runs some code forever until some condition is met is very common in all kinds of programs, such as our expert system here. Think about it, all it does is keep asking user for one of the two options forever, if the option chosen is to learn about capitals, it runs the code for that. This is just like the game logic. And once it is done, it just goes back and asks users for one of the two options again. Well, when is it going to stopper? It is going to stop when the user choose to. In which case, it jumps out of the loop and the program ends. So, let’s first get this scaffolding in place!

* So a game loop is just a “while” loop with “True” as its condition. And don’t forget about the colon at the end. Ok, we are inside the loop body now. The first thing is to ask =users to choose what they want to do. For this, we call function “input” and pass string “Do you want to (1) learn about capitals or (2) quit?” and assign its return value to a variable “choice”. Note that we put numbers 1 and 2 before the two options. This makes it easier to choose an option as user can just type in 1 to learn and 2 to quit. Ok, let’s run this now.

* Test. Right, it is asking us what to do, let me type in 1 and hit return, it then just asks the same question again. Same with option 2, type in 2 and hit return, same thing, it asks the same question again. This is expected because we are in a forever loop, and right now, neither option 1 or option 2 does anything. Let’s work on that next!

* So the option is now in variable “choice”, and depending on what choice is, we are going to do different things. First of all, what are the possible values for “choice”? Well it could “1” if the user wants to learn about capitals, it could be “2”, it the user wants to quit, and finally, it could be anything else, we don’t care, because none of them is going to be a valid option anyway. So once again, we are at a junction with three paths ahead. You know what to do right? Yes, time to bring out the “if … elif … else” statement again! Let’s do it!

* First, the “if” statement for the case when “choice” is “1”. The condition is just comparing “choice” with string “1” and see if they are equal or not. Note that we use a string “1” instead of a number 1, because, remember, function “input” always returns a string. So even if user types in number 1, it is going to return that as a string “1”. If you really want to have a number 1, then like what we did in the first Math Genius lesson, you need to covert that into a number with the built-in “int” function. But since we are not going to use “choice” for any number calculation, I don’t think the conversion is necessary, so will just leave it as a string. Ok, if “choice” is indeed “1”, then what should we do? Yes, it’s “1” when the user wants to learn about capitals, so let’s help them. Of course, we first need to ask them the country whose capital they want to learn about. So, call the “input” function again and pass string “Type the name of a country:” as argument, and store its return value in variable “country”. Cool, this will be the first step. For the rest, let’s not worry about them for now, because we just want to get the overall program structure setup. It’s like setting up the skeleton first, and then later filling in the flesh.

* Right, the next path, when choice is “2”. We need an “elif” statement. For its condition, we check if “choice” is equal to string “2”. If so, what does that mean? Yes, it means the user wants to quit and the program should end. This means it’s time to jump out of the forever loop. How can we do that? Yes, the “break” statement! So the code for this path is pretty simple, just a single “break” statement, and you are done! 

* Finally, if the choice is neither “1” nor “2”, it is not a valid option and the user should choose again. This is the third path and we use the “else” statement for it. The code for this case is also pretty simple, we just print “Invalid option, please try again.” That’s it, there is nothing else you need to do here. 

* So, pretty quickly, we have the skeleton set up to deal with all three possible cases. Let’s run the code and see if it works as expected. 

* Test. Ok, first, let me type in 1, and it asks me for a country, so how about “china”. Of course, we don’t have the code to find and get the capital for china yet, so nothing happened and the loop just repeats again. Let’s try something other than “1” or “2”, for example “3”, and it says “invalid option, try again” then repeats. Finally, say I want to quit, type in 2 and hit return, and there you go, the loop stops and the program ends. So this just shows that our code is handling all three possible options correctly. Pretty Cool! Of course, it’s just skeleton code, and its time to fill in the flesh, especially for the first option. |
| Check if input country exists | * Ok, all the intelligent bit of the system happens inside the “if” statement. After getting the country from user, it should now start to look for its capital and give it back to the user. Let’s see how this can be done.

*  There are two possible cases with each country asked by the user: whether the system knows about the capital of this country or not. If it does, simple, just give the capital back to the user and job done. If not, then it’s time for the system, rather than the user, to learn something new. Let’s look at both one by one.

* First, we need an “if…else…” statement to handle the two different cases. Now, for the “if” statement to handle the first case, how can the system tells if it knows about the country asked by a user? Yes, we can just check if it is in the “countries” list. If it is, then we know what its capital is, otherwise, we don’t. The question then becomes how to do we know if “country” is in the “countries” list? Or more general, how do we know if an item is in a list? Well, since we know that list is very similar to string, maybe we can get some inspiration from string? So how to know is a “character” is in a string? Yes, we use the ‘find’ method! It returns the index of a character if it is in the string, and -1 otherwise. So by checking its return value, we can decide whether a character is in the string or not. So maybe there is a ‘find’ method or something similar for list that can help us to decide whether an item is in a list? So let’s open the method page for list, can you find anything useful here? How about this “count” method? Its description says “Returns the number of elements with the specified value”. Let’s play with it a little bit in the shell.

* First, create a list of countries: “china”, “germany”, “france”, “thailand”, “china”, “france”, and “china”. Notice that some counties apprear more than once in the list, such as “china” and “france”. Let’s call “count” on the list and pass “germany” as argument. What does this do? Yes, it counts how many times country “germny” has occur in the list. So what should the answer be? Yes, one. Because “germany” occurs only once in the list. Now, what if I call the method again and pass “france”? Yes, two this time, because it occurs twice. Similarly, if I pass “china” it should return 3. Now, what if I pass “canada”? What do you think it is gonna return this time? Yes, zero! Because “canada” is not in the list so it appears zero times! And there you go, we now have a way to check if an item is in the list or not: simple count its number of appearances and see if it is zero or not. Nice!

* Ok, back to our code, to check if “country” is in the “countries” list, we can simple call method “count” on the “countries” list and check if its return value is NOT zero. How to check for inequality? Yes, we use the “!=” symbol. Ok, when this is True, we can print out the country’s capital in the “if” statement. How do we get its capital? Well, let’s leave that for later. Right now, we just want to make sure that the condition works, so we will create a variable called “capital” and assign an empty string to it, then we just use an f-string to print “The capital of ” then the “country” variable in curly brackets, the “is” and finally, the “capital” variable in curly brackets. So this would now just print empty for any country a user types in. We will deal with this later. Now, in the “else” statement, again, we just keep it simple for now and use an f-string to print “I do not know the capital of ”, then variable “country” in curly brackets, and then “Could you tell me?”. Ok, so the code for both cases are done, let’s test it.

* Test. Ok, choose option 1, country “china”, and yep, it prints “The capital of china is ” then nothing, this is expected, because we have an empty string for “capital”. Now, choose option 1 again, this time type in a country not in the list, “spain”, and yes, it says “I do not know the capital of spain. Could you tell me?”. Awesome! Looks like using the “count” method does help us to decide whether a country is in the list or not. 

* Ok, it is all good. But if you take this to an experienced Python programmer, he/she is gonna tell you “nah, this is not the way to go? This is NOT how you check if an item is in a list or not!”. What? Are there any better ways? Unfortunately, our experienced programmer friend is right, this is indeed not the best way. So what is the better alternative then? Well, it turns out that the alternative is actually simpler than using “count”. Well, you want to know if an item is IN a list? So just use the “in” operator. An “in” operator? What is that? Well, there are many different operators in Python, right? So are for number calculation, such as addition and subtraction, some are for logical decision, such as “and”, “or” and “not”, as we have learnt from last lesson. Now the “in” operator is just another operator that is used to check for membership, in other words, it checks if something exists in some other thing. And a list turns out to be one of those “some other thing”. So you can use this operator to check if an item is in a list. It’s very simple to use: want to check if “country” is in the “countries” list, just type in <country in countries>, and this returns True if “country” is in “countries” and False otherwise. So let’s use this for the “if” condition instead. Now, let’s test this again.

* Test. Ok, choose option 1, country “china”, and yep, it still prints “The capital of china is ” then nothing as expected. Now, choose option 1 again, this time type in a country “spain”, and yes, it still says “I do not know the capital of spain. Could you tell me?”. Awesome! The code works as before and the “in” operator seems to be working. Now, from this point on, every time you want to check if an item is in a list, always use this “in” operator. It is simple and it is the right thing to do.

* Ok, before we move on, what if I tell you there is a bug lurking in the code right now? Would you be able to find it? Ok, let me show you what the problem is. Now run the code again, choose option 1, and type in country “China”, hit return…and wait, what? Why couldn’t it find “China” this time? We tested with “China” before and it worked, right? And we have not changed any code since then, why it stops working all of a sudden? What is going on here? Can anyone tell me? Yes, well spotted! This time, when I type in “China”, I used an upper case letter “C” instead of a lower case one. See that? So why changing this single letter causes problem then? Well, take a look at the “countries” list, notice anything? Yes, all letters of all countries are in lower case, and because Python is case sensitive, remember? So “China” with an upper case “C” is not the same as “china” with a lower case “c”. From Python’s point of view, they are completely different strings, so when you check if “China” with a capital “C” is in the list, Python will say No! And this is why. Luckily, we have seen a similar case before in the “Animal Quiz” lesson, and the solution is pretty simple, we just need to call the “lower” method on the “country” variable to turn it into all lower case before checking its existence in the “countries” list. Now let’s test this again.

* Test. This time, if I type in “China” with a capital letter “C”, it is able to find it in the list. And same with “china” with all lower case letters. And even if I type in “CHINA” with all upper case letters, it still works. Pretty awesome! |
| Find capital for a country | * Ok, now we have the country in the “country” variable, and we know that it exists in the “countries” list. It’s time to find its capital city. How can we do that? We have two lists here, one for all the countries and one for all their capitals. When we created those two lists, I mentioned that there is a one to one relationship between them: the first country’s capital is the first item in the capital list, the second country’s capital is in the second item in the capital list, and so on and so forth. So based on this knowledge, can you find a a way to get the capital city for a country? Yes, so if we can find the exact position of the country in the “countries” list, then we can also find its capital at the same position in the “capitals” list. So what is the position of an item in a list? Yes, its index! So the solution becomes: if we can find the index of the country in the “countries” list, then we can also find its capital at the same index in the “capitals” list. 

* So we need two steps for this. First, find the country’s index in the list. Previously, we have used the “count” list method to count the number of times an item appears in a list, right? So, maybe there is another method to get the index of an item in a list? Let’s find out! Can you find anything useful in the list method page? Yes, the solution is pretty obvious, there is a method called “index”, what does it do? Well, its description says “Returns the index of the first element with the specified value”, in other words, you give it an item, it returns that item’s index in the list. Exactly what we need! So, in the “if” statement, we call this method on the “countries” list and pass “country” as the argument. Then assign its return value to a variable called “index”. Cool, first step done!

* Now, the second step, with the country’s position in the “index” variable, how can we find its capital in the “capitals” list? Easy! We just get it from the capitals list using this index. So instead of assigning an empty string to “capital”, we now use the “index” variable to get the capital city from the “capitals” list. That’s it! Let’s test the code!

* Test. Now, if I type in “china”, it prints “beijing” as its capital. Cool. If I type in “germany”, it prints “berlin”. Awesome! But check this one out: if I type in “China” again, but this with with a capital letter “C” and hit return …. Ouch! We have an ValueError. The error description says “’China’ is not in list”. And the line of code that caused this problem is this one, when we call the ‘index’ method. Based on these information, we can kind piece together what happend: the second time I typed in “China”, it has an upper case letter “C”. Because Python is case sensitive, this is not the same as “china” with all lower case letters. So when we try to get the its index from the list with a non-existent item, Python is going to complain with a ValueError. This cause is pretty clear. But why? Haven’t we already converted the “country” variable into all lower case here in the “if” condition? Why are we still getting this error? 

* OK, to explain this, we first need to understand something important about strings: strings are immutable in Python. Right, another fancy word! Ok, let me make it less fancy: immutable essentially means strings cannot be changed. What? But we have been using method such as “lower” to change all its characters to lower cases, right? Why are you saying that strings cannot be changed? Right, to understand this, let’s go to the shell. Let me create a variable called “country” and assign string “CHINA” with all upper case letters. Now, let me call “lower” on the variable and hit return. Ok, it prints “china” with all lower case letters, as expected. You might say “Aha, I have told you, strings can be changed!” Well, can they? What if I print variable “country” again here? Do you think we are going to see an all upper-case “CHINA” or an all lower-case “china”? It must be all lower-case, right? Let’s find out. Aha, see, the string in the variable is still all upper case. So you have not changed the string at all and value stays the same! So what is this string with all lower case we are see before? Well, what happen when you call method “lower” is on the “country” variable is that, Python did not change the string in the variable directly, instead, it creates a copy or a clone of that string, so you now have two strings the look the same, then it changes all letters of that clone to lower case instead. And finally pass you back that clone as the return value of the “lower” method. So the original string in the “country” stays the untouched. This is how strings work. In fact, if you look at all the string methods that might seem to change the string on the surface, they all do the same trick by creating a clone, change that clone, and return the clone back to you. 

* So back to our code. Yes, we did convert all letters of “country” to lower case in the “if” condition, but from what we have just learnt, this does not change the string stored in the variable, it simply just creates a clone of that string and changed to clone to all lower case. So when later in the “if” statement where we call the “index” method again using the “country” variable, it still has the upper case letter “C”. And we already know the rest of the story. So, once you know what went wrong, then fixing it is trivial, we just need to call “lower” again on the “country” variable before it is passed to the “index” method. And that should fix the bug! Let’s confirm it!

* Test. Type in “China” again with an upper case letter “C” and yes, it prints beijing as the capital. Awesome! OK, so when the country is actually known to our expert system, it has no problem in finding the capital city! That is good! But right now, when the country is unknown, it just say “sorry, I don’t know” and gives up. That’s not the attitude a good system with crowd intelligence should do. In fact, just like us humans, when you are faced with something you don’t know, instead of just putting your hands up and giving up, you should try your best to learn about it! And that’s what we are going to work on next for our system!  |
| Learn from user for unknown country | * Right now, when a country is unknown, the system simply prints out “I do not know the capital of the country. Could you tell me?” It is asking the user to provide the capital city so that it can be added to the knowledge base. The first thing we need to change is this “print” function call: this is not the way to get any input from a user. Instead, we should call the “input” function. There is no need to change the message, just leave it as it is. We also need to store the “input” function’s return value somewhere. Because this is going to be a capital city, so we store the return value in a variable called “capital”. 

* Right, now we have the country in the “country” variable and its capital in the “capital” variable, time to update our system’s knowledge! This is just adding the country to the “countries” list and capital to the “capitals” list. We have already learnt how to add a new item to a list using the “append” list method. So let’s call this on the “countries” list and pass the “country” variable as argument, and call this on the “capitals” list and ass the “capital” variable as argument. Also, we want everything added to both lists to be in lower case, so let’s call method “lower” on both “country” and “capital”.  OK, let’s test the code!

* Test. This time, let me type in “India” as the country, note that I have used a capital letter “I”, and the system says it does not know about India and asks if we can tell it. Sure, I go online and find out that the capital of India is “Delhi”, so let me type that in with a capital letter “D”. Ok, if everything works, then the system’s knowledge should be updated. So, let me ask it with “India” again, note this time I’m using a lower case “i”. Hit return, and there you go! It can now replies with “delhi” as the answer. Pretty cool. So as more and more people use our system, its knowledge base will just keep growing and it’s become better and better to answer people’s questions. Nice! |
| Use dictionary | * Ok, so the system is pretty much finished. We have hit all our goals. You can change the system to specialize in a different area other than countries’ capitals. So you might think we done here? This is a short lesson! Well, not quite. And the fun has not even begun yet! Let’s see what else we can play around with the code!

* Now, as we said at the beginning of this lesson, the knowledge base is basically just a collection of pairs, first item of the pair is the country and second item of the pair is its capital. And we have split all these pairs into two list, one for all the countries and one for all the capitals. This approach works, as we have just demonstrated. But just because it works, does not mean it is the best approach. And remember, as programmer, we should always find the best way we can to solve a problem. So let’s first see what the downsides of this two-list approach is.

* First, imagine you want to have a really big knowledge base to start with, say with 100 countries with their capitals. Now, each of the two lists are going to be 100 items long. Remember, the items in both list need to match each other up one by one, right? But with such long lists, it can be quite easy to mismatch a country with its capital. Especially when you add or remove new pair. And once things are mismatched, it could also be quite difficult to figure out where it got messed up.  

* The second problem is, there is just too much work to find the capital city of a country. Still remember how we did it? Yes, we first get the country’s position in the “countries” list, then use that position to index the “capitals” list to find its capital city. It’s a bit like when you want to call Bob, instead of getting his number and call directly, you call Alice first, ask her for Bob’s number, get the number and finally call Bob. Now, any normal person would tell you this is crazy! How would anyone do that? Yes, that’s right, it is crazy and nobody should do that! Instead, what do we normally have to help us in such situation? Yes, we have something called a “phone book”. What is a phone book for? Yes, it is for you to quickly find out the phone number for any person. What does each item in the phone book looks like? Yes, it’s just a pair of person’s name and his/her phone number, right? So if you need Bob’s number, just look for his name in the phone book, and once you can locate that, you get his number at the same time. There is no need to call Alice anymore! So so here, with out counties and capitals: if we already have a country, shouldn’t we just go for something like a phone book and find out its capital straightaway?

* Fortunately, looking things up this way is so common in Python that there is something like a “phone book” called “Dictionary” just for that. So what is dictionary? I mean like in real life. Yes, a dictionary is something like a book, storing a huge number of word-and-meaning pairs. When you come across a new word in a book or on the internet, and not sure about what it means, then you can open up the dictionary, look for that word. Once it is found, you also get the description of what this words means, how you can use it etc etc. And a dictionary in Python is just like that, you have something to look things up with, which we normally call a “key”, and then use that “key” to get the actual things you are after, which we normally called a “value”. So a dictionary is just a collection of key-value pairs and the keys are used to look up values quickly and directly. 

* Ok, let’s first open the shell and see how a dictionary can be used. Like a list, a dictionary is used to store a collection of data instead of just a single value. But unlike a list, each item in a dictionary is a pair of key and value. To create a dictionary, you first use a pair of curly brackets. Then inside the brackets, you add the pairs one by one. To use our country and capital as example, country would be the key and capital would be the value. So to add a pair such as “china” and “bejing”, you type in string “china” first, then a clone and finally string “beijing”. So this is a key-value pair, with the key being “china” and value being “beijing”. Now if we want to add more pairs, just like in a list, we separate the items using commas. So to add another pair, we first type in a comma, then the key string “germany”, colon and the value string “berlin”.  There you go, we now have a dictionary with two items inside. We can then assign it to a variable called “capitals”. Now, once this is done, getting the capital for a given country is very simple, just like looking up a number in a phone book. Say we have country “china” and want to find out what its capital is. Like indexing a list, we first type in name of the dictionary “capitals”, then a pair of empty square brackets. Note that this is a  square bracket and not a curly bracket. When indexing a list, we use a number index, which represents the position of an item in the list, and pass that in the square brackets. This returns the item at that index. With a dictionary, to get a value by passing its corresponding key in the square brackets. So to find out what the capital is for “china”, we pass the key “china” between the square brackets. Now, if we hit return, “beijing” is printed out. If we use “germany” as the key, then “berlin” is printed out.  What would happen if we pass a key that is not in the dictionary, for example, “france”? Let’s try! Now, we are getting a KeyError, meaning you are trying to index the dictionary using a key that does not exist. So it’s often a good practice to check if a key exist in a dictionary before you try to index it, to avoid getting this error. So how can we check that? Well, how do we check if an item is in list? Yes, we use the “in” operator. Actually, we have just learnt about this and used it in our code here. Surprisingly, this “in” operator can be use with a dictionary as well to check if a key exists or not. So to check if “china” exist in “capitals”, I can just do <”china” in capitals>. Hit return and it prints “Ture”, meaning “china” is a key in the dictionary. If I do <”france” in capitals>, Hit return and it prints “False” this time, meaning “france” is not a key in the dictionary. So with the “in” operator, you can now easily check if a key exists or not. Pretty cool! Now, of course, if a dictionary is used store all the knowledge of our system, there must be a way for the knowledge to grow, meaning being able to add more country-capital pairs to it. With a list, we use method “append” to add more items at the end of the list. With a dictionary, there is a method too. By the way, like a list, there is also a web page with all the dictionary methods. So from this list of methods, can you find the one that allows us to add a new key-value pair? Yes, the “update” methods looks promising. Its description says “Updates the dictionary with the specified key-value pairs”. Let’s open the page for this method can see how to call this. So from the example, we can see that to add a new pair, we call this method on the dictionary, then what is passed as argument to this method? It has a pair of curly brackets, and inside there are two string separated by a colon, so what is this? Yes, it’s just another dictionary with a single pair. So back to our shell, say we want to add “france” and its capital “paris”, we just call method “update” on “capitals”, and a pair of brackets, for the argument, we create another dictionary with a pair of curly brackets, then inside, we add the new pair: key “france”, colon, and then value “pair”. Now hit return. To check if this new pair has been addedd, just type in “capitals” and hit return, this prints out all the key-value pairs in the dictionary. And we can see “france” and “pair” there. Cool! Ok, this is one way to add a new pair. But there is another way that I personally think is simpler. Say I want add another country “india” and its capital “delhi”. All you need to do is type in the name of dictionary “capitals”, then a pair of empty brackets. Within that brackets, type in the key of the new pair, which is “india”, then assign to it the value of the new pair “delhi”. And that’s it, this is a more convenient way to add a new pair to a dictionary. Now, we can print out “capitals” again and you can see “india” and its capital being added. So does this look familiar? Yes, when we leant about list, we use a very similar syntax to assign a new value to an item in a list. You know what, this same syntax can be used to change the value of a pair in a dictionary as well! For example, historically, the capital city of india is called “delhi”, but in 1931, the India government changed its name to “new delhi”. So to update our knowledge with this new information, we need to change the “india”-”delhi” pair. So just like adding a new pair, we can have the dictionary’s name “capitals” followed by a pair of empty brackets, in the brackets, is the key of the pair we want to change, so “india” and then we assign a new value “new delhi” to it. Hit return. Now, let’s print the dictionary out again, and as you can see, the value of the pair has been change to “new delhi”. In summary, when you use this syntax, if the key does not exist, you add this new pair to the dictionary; on the hand, if the key does exist, you change its value to the new one. This is important to keep in mind.   

* So, finally let’s get back to our code and see how we can improve it using a dictionary! First thing, we no longer need two lists to store the countries and capitals. They can be combined into one dictionary. As we have just learnt, we create a dictionary with a pair of curly brackets.  Then let’s assign it to a variable called “world”. Right now, this is an empty dictionary, so let’s add the data in. They will just be pairs of countries and capitals. Each pair has a key, so a string “china” then a colon, followed by the value, a string “beijing”. We just need to add all the countries and capitals in both lists into this new dictionary, with all pairs being separated by commas. 

* Ok, once this is done, we can start to change the code to make use of the new dictionary instead. let’s check line by line to see where changes are needed. When user chooses the first option, we receive the country, and then check if country exists or not. Now this “if” condition was checking if “country” is in the “countries” list. But since all the knowledge are now in a dictionary, we need to check if “country” is one of the keys in “world” instead. As we have seen, we can still use the “in” operator and change “countries” here to the dictionary “world”. Right, next, if the country exists in “world”, we need to get its capital. Previously with two lists, we have to do it in two steps, first get the index of country in the “counties” list and then use that index to get its capital from the “capitals” list. Now, with dictionary, this becomes super simple, we already have the key in the “country” variable, so getting the value associated with it is as simple as doing “world”, square brackets and then the key “country”. Also make sure country is convert into all lower case. This gives the country’s capital and let’s assign it to the “capital” variable. Now we can delete these two lines of code. Ok, let’s test what we have changed so far.

* Test. Run the code, type in “China” and it prints “beijing” as the capital. Try again, this time “uk” and it prints “london”. So looks like everything works as before, but this time we are using the cooler dictionary instead. Nice!

* Ok, next let’s take a look at the “else” statement when a country is not found in “world”. Previously, we add the new country and its capital to both lists to update the system’s knowledge base. Now, we still need to update the knowledge base, but this time adding this new pair to the dictionary “world” instead. Again, as we have seen in the shell, adding a new pair is as simple as doing “world”, square brackets, then the new key “country” inside, and assign the new value “capital” to it. After that, we can delete both “append” function calls. Let’s test this and see if everything still works.

* Test. This time, let me try a country that does not exist yet, “japan”, ok, the system says it has no idea what the capital for “japan” is, so let’s type in “tokyo”, and hit return. Now, if everything still works as before, this new pair should be added to the “world” dictionary. Let’s find out, this time if we ask for “japan” again, aha, it says the capital is “tokyo”. So it has learnt and the knowledge based is updated. Perfect! 

* Ok, after all the changes and tests, the system still works, doing everything we want it do nicely, we can finally delete these two lists. Cool! Also,  |
| Read capitals from a file | * OK, cool. This is all looking good. However, from what we have learnt from last lesson, when you have a collection of data that need to be used by a program, it is better to have those data stored externally in a file rather than having them directly in the code. This always makes it easier to update the data without ever needing to change the code. So here, again, we have a situation where a collection of data about countries and their capitals directly written in code. So let’s move them to a file and then read from it instead.

* Ok, in the last lesson, the data we have is simply a list of words, so the file we use to store them has multiple lines, each line contains one word, right? Now, here, each data item we have is a pair with a country and its capital, so a pair of word. In this case, what should be the file look like? Let’s first create a file and call it “world.txt”. So it’s a txt file. Ok, open it in the editor and right now it’s just empty. Let’s add some data. So currently we have 5 pairs in the dictionary, so like the list of words, we are going to add them line by line with 5 lines. The question is what each line is going to look like? So let’s take the first pair, “china” and “beijing”. In the first line of the file, type in “china” first, that’s the key of the dictionary, then how about the value? Well, of course, we need to separate these two words, and in theory, you can use any character to separate them: for example, space, common, colon, maybe event a star. But I would like to use “comma” when it comes to separating multiple words in the same line. So type in comma and the capital “beijing”. Ok, that’s it, this is the first dictionary item stored in a file.  And the other four are similar and I will just add them quickly here. Ok, all done and save the file.

* OK, back to the code. Now we have all the world saved in a file, it’s time to read from it. From last lesson, we already know how to open and read from a file.  We first call the “open” function and pass the name of the file as its first argument. Also, do not forget to pass the second “mode” argument, here because we are going to read from the file, so we pass string “r” for read. We assign the return value to a variable called “file”. This is what we are going to use to read from it. Next, just call “read” on the “file” variable and assign the return value to variable “content”. So “content” now stores a big string with everything in the file. OK, very importantly, once you have finished reading an open file, always remember to close it before moving on. Finally, we called the “splitlines” string method on the “content” variable to split it into a list, each item of the list is a single line in the file. We store this list in a variable “lines” for now. Ok, so far, nothing is really new here, we have seen all these in the previous lesson. 

* But in that lesson, we are done with reading and processing the data from file at this point. Because each line has just a single word, and we already have all the words in a list after calling “splitlines”. Here, “lines” is also list, but do we really need a list here? Now, we need a dictionary! Let’s first see what “lines” looks like by printing it after the split. Let’s run the code.

* Test. Ok, as we can see from the output, “lines” is a list of strings. But this time, each item is a not a single word, but a string with a country, a comma and a capital. So our goal is to convert this list into a dictionary so that our code can use it later.

* Let’s think about how to do it. Say you were given a string such as “’china’:’beijing’”. First, we need to turn that into a pair of two strings: “china” and “beijing”. Once we have that, adding it into a dictionary is going to be very simple, we already know to do that. And we if can split all the strings in “lines” list and add them in to a dictionary, then we will once again have a world with all the countries and their capitals. OK, let’s first go to the shell to see how a string like this can be split. Let me first create a string “china:beijing” and assign it to a variable “line”. Now, think about the “:” as a separator, we want to split this string into two parts, one before the colon and one after. This is like the opposite of the “join” string method, where we use a separator to join multiple strings together. So where do you think we can find the answer for splitting string? Yes, the string method web page. Let’s open that up and see if you can find anything useful. Yes, the “split” method! Let’s open its page and see how the method can be used. As we can see from the example, you can just call this method on a string to split it up using spaces with passing any argument. So this example sentence is going to be split into 6 different strings. But in our case, we need to split based on colon rather than space. What should we do? If you scroll down the page a little bit and go to the Syntax section, you will see that the “split” method can actually accept two parameters: “separator” and “maxsplit”. We do not need to worry about “maxsplit” here. But the “separator” parameter looks interesting. What do you think that is? Yes, it’s a separator use to split the string. And what separator should we use here? Yes, the colon. So let’s do that. Call method “split” on the “line” string, and pass a string with a single “colon” as the argument.  Assign the return value to a variable called “pair”. Hit return. Now, let’s print out “pair”. Ok, what do you think this is? Well, it has a pair of square brackets and two string items separated by a comma, I think it is a list. What do you think? Yes, it is a list with two strings. So to the get the first item of the pair, we do <pair[0]>, hit return and “china” is printed out. To get the second item, we do <pair[1]>, hit return and “beijing” is printed out. Cool, so the long string we have initially has been split into two strings in a list. With those two strings, can easily add them into a dictionary! Nice!

* Ok, back to our code. Since we are going to add the countries and capitals from a file, we no longer need to do it in the code. Let’s remove the value assigned to the “world” dictionary variable here. Instead, we want to start “world” from an empty dictionary. An empty dictionary is just a pair of curly brackets with nothing inside. Let’s assign that to “world”. Next, after reading the content from the file and split it into lines, let’s go through each line and split it up. Since all the lines are already in list “lines”, we can use a “for” loop to go though it. You should be pretty familiar with this by now, so “for” then the loop variable, I’m gonna call it “line”, then ”in” and finally the list lines. Inside the loop, we first split the line by calling “split” method on the “line” variable and pass “:” as the separator argument. Assign the result into variable “pair”. Now, get the first item from “pair” and assign it to variable “country”, get the second item from “pair” and assign it to variable “capital”. Once the country and capital are available, we can add them to the dictionary by simply type in the dictionary variable “world”, then a pair of square brackets. In the brackets, pass in the key “country” and finally, assign the value “capital” to it. OK, after the loop, just to show that all countries and capitals from the file are added successfully into dictionary “world”, let’s just print it out. Ok, run the code.

* Test. As we can see from the output, first it prints the list of lines from the file. Then after the loop, it prints the dictionary. A quick look at both can confirm that everything in the list has been converted and added to the dictionary successfully. Pretty cool! Now, since everything works, we can delete the two “print” function calls here to make the output cleaner. |
|  Save capitals to file | * Ok, let’s think about what happens after you have learnt something new. You would keep those new knowledge in your head right? Yes, I know, sometimes, we tend to forget what we learnt, but if you just keep practicing it, eventually it stays with you forever, right? And even after one night sleep, you would still remember it when waking up the next morning. And this is how we make progress, as we keep learn day by day, our knowledge base grows and we can are able to solve more and more problems. Now imagine what it would be like you just forget everything you’ve learnt yesterday when you wake up in the morning. That would be terrible, so you would keep learning the same thing again and again without ever making any progress. This is just hopeless.

* Now, back to our program, we now know that it can learn new countries and their capitals. Say it’s been used by a lot of people for a while, answering their questions and at the same time learning something new. Now, say the power just goes out for some reason or our computer gets dangerously hot because it’s been running for too long, in either case, the program is shutting down. Now, if we run the same program again, do you think it would still remember all the new things it has learnt? Let try!

* Test. Run the program, let’s ask country “japan”, the system dose not know about it, so we give it the answer “tokyo”. And if now we ask it again, it has learnt about it and replies “tokyo”. Nothing new here, we have seen this before. Next, let’s ask country “kenya”, again it does not know about it, so we give it the answer “nairobi” again. If we ask it again with “kenya”, it replies “nairobi”. Cool, so the system has learnt two new countries. Ok, say, our computer is getting to hot now, so we have decide to exit the program and maybe this helps to cool it down. Ok, let’s run the program again, now see what happens when I ask “japan” again, wow, looks like it has just forgotten what it has learnt. How about “kenya”, same thing, no memory of that at all. So the system is back to square one! It is as if it has never learnt anything new! Well, this is terrible, because if we want those new knowledge, then we have to teach all over again. And the next time there is power outage and the program shuts down, we lose everything again! Oh no!!!!! 

* This is bad. But fortunately there is solution: we have a file right? What if we can store all the new countries and capitals into that file? Would they still be available if the program shuts down? Data in the dictionary is like what’s called “short-term memory”, knowledge inside can be easily forgotten. But our brain has something called “long-term memory” too, once things are stored there, they are remembered forever! This is just like a file, once you store data inside, it does not go away if your program shuts down. So to make out system a better learner, we need to store all the new knowledge into a file. 

* OK, in the last and this lessons we have seen how to read data from a file. So data is coming from a file into your program. But data can also flow in the opposite direction, from your program into a file. And we call this “write to a file”. In this case, we want to write all the new countries and capitals our system learn back into the file. So how we do we do it? Now, when reading a file, you call function “open” first. This is a like you open a box first before taking anything out from it. So to write to a file, we also need to open it first, just like you need to open the box first before putting anything in. So before the while loop, we call “open” again, the first argument is still the name of the file, but the second one argument should not be “r” again since we are no longer reading a file. Then what should it be? Well, remember when we first learnt about the “open” method, we saw a few different values you can use for the mode? If you don’t remember what those are, we can take a look at the “open” method page again. So apart from “r” for read, there are two values that are related to writing a file: “a” for appending and “w” for writing. At first glance, you would think that surely we should use “w” because we are writing a file, right? Ok, spoiler alert, this is actually NOT  the mode you should use. But to see why, let’s use it anyway and see what would happen. Ok, pass “w” as the second argument for “open”.

* Now, where in the code do you think we need to write any new knowledge in to the file? Yes, it’s here when the system has learnt the capital of a new country from the user. So we still need to add this pair into the dictionary for short-term memory, but additionally, we also want to write to the file for long-term memory.  So how do we write to a file. Well, when reading from a file, we call the “read” method on the “file” variable, right? So for write, I think there should be a “write” method somewhere? Maybe? Let’s find out in the file method page. Open that page and can you find anything useful? Yes, there is a “write” method! Let’s open the page for it and see how to use it. So looks like you just pass whatever you want to write as a string argument. That’s easy! So what do we want to write? Yes, we want to write the country, then a comma and finally its capital. So let’s do that, “file”, dot, “write” and brackets. In the brackets, let’s pass an f-string. The first to write is variable “country”, so in the f-string, add a pair of curly brackets and pass variable “country” in. Then a comma. And the next one is the capital, do add another pair of curly brackets and pass variable “capital” in. That’s it, that should write the new pair into the our “world.txt” file. Ok, as I mentioned earlier, the mode “w” for write is not the right one to use when you want to open a file for writing, because this can make you lose your data file. Sounds scary? So before we run the code, let’s back up our data file first. Create another copy of “world.txt” and rename it to “world.bk.txt”. “bk” here simply means backup. Now, if anything terrible happens to “world.txt”, we still have all the data in “world.bk.txt”. Right, once the backup is done, let’s run the code.

* Test. Let me type in “japan” for the country, since the system does not know about it, let me type in “tokyo” for it. Now, if I ask for “japan” again, it replies “tokyo” so things has gotten into our system’s short-term memory. So far so good! But remember, we also store this new knowledge into our long-term memory too. If we open file “world.txt” now, we should see a new pair “japan,tokyo” in the file right? Let’s find out. Open the file and … what is going on here? The file is completely empty now! All our previous data were gone and the new data is nowhere to be found either! This is very strange! OK, let’s see what went wrong. First, we clearly called the “write” method here to write “japan” and its capital “tokyo”, and the data is in the dictionary, because when we asked for “japan” again, the system can replied with “tokyo”. So why has this new data not been written to the file? 

* Now, think about going shopping at a supermarket, you add the items one by one to your trolley, and once you have everything, you go to checkout to pay right? What you don’t do is add one item to the trolley, go to the checkout to pay for that, and come back to add the next item. This back and forth is inefficient and a waste of time, right? Now, the “write” method actually works similarly, when you call it, it does not write the data into the file right away. Think about the data as a shopping item, and writing it to a file as paying at the checkout. Instead, it holds the data somewhere, like adding the item to a trolley, just in case you want to write more data in the future. At some point, when it has enough of data at hand, it finally decides: Ok, it’s time to write everything to file. This is like when you have all the items you need, you finally go the checkout to pay for them. And only then can you see the data in the file. So simply calling “write” method here does not guaranteed that the data will be written to file immediately. However, if you do want the data to be actually written to file everytime you call “write”, there is a way to do it: open the web page for all file methods, find the one called “flush”. Its description says: “Flushes the internal buffer” Don’t worry if you don’t know what it means, simply think of this as taking all your items in the trolley and pay at the checkout. So if we call this method after each “write” method call, then the new data will guaranteed to be written to file right away. Let’s test this. First, we need to recover all data for “world.txt”. Luckily, we made a copy of of that previously in file “world.bk.txt”, just copy the data from there and paste them back in file “world.txt”. Next, call “flush” after the “write” and run the code again.

* Test. OK, type in “japan” and “tokyo”. Now, if we take a look at “world.txt” again this time, aha, you can see the new data there! Pretty cool! Before we move on, I have to point out that calling “flush” after each “write” is generally not a good idea because, well, paying at the checkout each time you add a new item to the trolley is not very fun. But we do it here anyway for two reasons, firstly, I want to teach you about “flush” as you will probably need it in the future. Secondly, we do want to make sure data is written to the file each time. Ok, but we still have a big problem here: all our previous countries and capitals in “world.txt” are gone! We are now left with the new data only, just “japan” and “tokyo”! Imagining wiping out all your memory every time you learn something new! That will be horrible! A disaster! So what went wrong here?

* Well, remember earlier when we call “open” method to open the file for writing? We passed “w” as the mode and I said this is not the way to go, right? And now you see, why this is not the way to go: when you open a file that already exists, such as “world.txt” here, what this write mode does is it erases all existing data in the file and then start writing new data. This is just the way it is. Now, if you ask: how can I just add new data on top of existing one without wiping them out? Fortunately, there is a way. Remember all the modes you can pass to the “open” function. If not, just open that web page again. We have already see “r” for read, and “w” for write. Well actually, to be more precise, “w” is for wiping out old data before write. Now, there is another mode “a” for “append”. Well, what does “append” mean? Think about a list, how do we add a new item to list? Yes, we use its “append” method. And this methods just adds new item at the end of the list without wiping out all previous items. So what do you think the “append” mode for “open” is for? Yes, it adds new data to the end of a file without wiping out all previous data. Sounds exactly like what we need here. So, let’s change the mode in the “open” function call to “a” for appending data this time. Also, let’s get all our old data back from the backup file “world.bk.txt”. We can just delete the current “world.txt” file and rename “world.bk.txt” to “world.txt”. Ok, let’s run the code.

* Test. Again, let me ask “japan”, the system does not know it, so type in “tokyo”. And now ask “japan” again, and it replies “tokyo”. All works as before. Now, if we open “world.txt”, we should see “japan:tokyo” this time, right? Let’s find out! And….Yes! We see “japan, tokyo” has been appended to the end of the file. And all the old data were still there, nothing is lost. Awesome! Let’s try to add one more. This time, I’m gonna ask “kenya”, and the system has no idea about that, so I will type in its capital “nairobi”, so this should be appended at the end also, right? Let’s find out! Open the file, and….ouch, this pair has been added to the file, but at the wrong place: instead of being appended in a new line, it was added after “japan” in the same line. So what went wrong here? OK, the problem is still at this “write” function call here. When you finish writing something, if you don’t anything, then the next “write” is going to continue in the same line as this one. If you want the next “write” to start writing its data in a new line, you have to tell the current “write” to start a new line once it’s done. Fortunately, this is pretty simple, all you need to do is to write a “new line” character after finishing writing a string. The “new line” character is one example of an “escape character” in Python. The “escape” characters are not meant to be shown but rather to tell Python how to format strings. The “new line” character is used to tell Python to starts a string in a new line. This character is a string that starts with a backslash character followed by the letter “n”. In fact all “escape” characters start with a backslash. But we will not look at those in this lesson. Now, all we need to do is to write a newline character after writing the country and capital. Now let’s delete the last line in “world.txt” and test it all over again.

* Test. Ok, first “japan” and “tokyo”, taka a look at “world.txt”, yes, the new pair is there! Now it’s “kenya” and “nairobi”, take a look at “world.txt” again, and Yes, this time, the new pair is in it own line at the end of the file. The new line character works! Perfect! Of course, to save some typing, instead of calling “write” again to just write a newline character, we can combine both “write”s by simply adding the new line character at the end of the country-capital string. This would also work.

* Now, finally, the system is able to store all the new knowledge into its long term memory, the file. And what is the biggest benefit of doing this? Yes, we no longer need to worry about power outage, or our system crashing in the middle of running the program. All new knowledge are now sagely stored in a file. Also, we can quit the program at any time because we know what when it is run again, we still have all the new knowledge available. Ok, this all sounds good in theory, let’s confirm.

* Test. Now let’s quite the program by typing in 2 and hit return. Right the program is stopped. Now, run it again, this time if I ask “japan” and it replies with “tokyo”, and if I ask “kenya”, it replies with “nairobi”! See, our system is getting better and smarter! This is what I would call a “crowd intelligence” system. Perfect!

* OK, before we call it a day, there is just one final little thing we should take care of. When opening a file for read, we should always remember to close the file when its content have been read, right? Same with opening a file for write, when we finish with all the writing, we should also close the file. So when do we have no more data to write to “world.txt”? Yes, when we choose to quit the forever “while” loop. So after the loop, let’s call “close” on the file to make sure everything is nice and clean. Good! |
| Summary |  |

### Exercise

- There is a bug in the code when either “country” or “capital” from the user is an empty string. Can you fix that?
- Try to use a different separator in “world.txt”, such as space, and see how to change the code.
- What if we don’t have a “world.txt” file to start with? Which mode should you use to open it?
- Can you add user-defined functions to make the code more readable?