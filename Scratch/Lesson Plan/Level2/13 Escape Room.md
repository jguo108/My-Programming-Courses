# 13 Escape Room

[Projects | Computer coding for kids and teens | Raspberry Pi](https://projects.raspberrypi.org/en/projects/create-your-own-world)

### Reference

[Key press block difference on Scratch (mit.edu)](https://scratch.mit.edu/projects/18453174/)

[what's the difference between 'key pressed' and 'when key pressed'? - Discuss Scratch (mit.edu)](https://scratch.mit.edu/discuss/topic/240822/?page=1#post-2460297)

### Objectives

### Background

### Project

### What to learn

- Recap on Game Pattern
- Forever loop plus if key pressed to move player
- Collision detection and resolution
- Finer grain stop using “stop scripts in sprite” rather than the all powerful “stop all”
- Always test the not so happy case of your program
- Disable one part when testing another part of the code

### Blocks

- key pressed (diamond block)
- wait until
- stop other scripts in sprite
- stop this script

### Lesson Plan

| Step | Details |
| --- | --- |
| Introduction | * Escape room introduction
* Today, we are also going to create a simple escape room. And your task is to complete all the challenges and eventually escape from the portal.
* Let’s first play the game to get a feel of what it is like and how you can escape. When the game begins, our player starts in the first room up here, closed by a dangerous laser gate. There is a computer in the room and that’s your chance of getting out! The computer asks you a question once you touches it. If your answer it correct, the laser gate opens. Now, watch out for the enemy when you try to get out of the room. Once you are out, it’s time to go to the second computer for yet another question. But watch out for the revolving gate. If you answer the second question correctly, the laser gate for the second room opens. And move carefully to that room, avoiding both the revolving gate and the second enemy. Once you touch the third computer and answer the last question correctly, the final laser gate just before the portal opens! And all you need to do is move careful again to the portal and then you are out! Hooray! 
* I think this is a pretty fun and challenging project, so let’s not waste any time and get started now!  |
| Scene | * Ok, so I have already prepared an escape room for you: just go to stage, click backdrops, and select the image “room” from the Resources folder. There are a lot of other images for the different sprites of the game. We will add them later on as we progress through the project. |
| Player (setup and run) | * Ok, let’s add our first sprite, the Player. Again, upload the image “Player” from the Resources folder. And move it to the upper left corner.
* In lesson “[Race to the Island](10%20Race%20to%20the%20Island%208d244dc379844c1e85601f7a2302e706.md)”, we introduce one common code patterns for games: setup and run. So just to recap, the game is divided into two separate phases, the first “Setup” phase and the second “Run” phase. In the setup phase, you prepare all the sprites in the game, for example, moving them to the right start positions or switching to the correct costumes etc. 
* So, when the green flag is clicked, we first broadcast a “setup” message and wait. Do anyone recall why we need a “broadcast and wait” instead of just the “Broadcast” block? Anyone? Yes, because we want to only start the game when all the sprites are ready. So we broadcast the message and wait until everybody is done. Then we can just broadcast a “run” message to actually run the game.
* Ok, when the player receives the “Setup” message, make it go to its current position. And that’s it, there is nothing else we need to prepare the player for. |
| Player (movement) | * Ok, so in this game, we would like to use the arrow keys on the keyboard to control the player’s movement: left, right, up and down. In lesson “[Turtle Crossing](../Level1%2051869bb3a8274fd0910ceb115e2e8daf/6%20Turtle%20Crossing%202cdafea6327c41f4872354ffed1c4938.md)”, we used the “when key pressed” hat blocks to change the turtle’s direction when each arrow key is pressed. But here, we are not going to change player’s direction, instead we want to change its position. For example, when down arrow key is pressed, we want to move it down a little bit and when up arrow key is pressed, we want to move it up a little bit. Same for the left and right arrow keys. So let’s first add a “when key pressed” block and select the “down arrow” key. Ok, how do we move a sprite down on the stage? In lesson “[Catch the school bus](../Level1%2051869bb3a8274fd0910ceb115e2e8daf/3%20Catch%20the%20School%20Bus%20fdbbff664179483cb3667e1a7c54dfd5.md)”, we have seen that the “change x by” and “change y by” blocks can be used to move a sprite along the up/down or left/right direction. That’s exactly what we need here: when the down arrow is pressed, should we change y or x? Yes, we need to change y because it’s moving down. And because it’s moving down, so let’s change y by -2. 
* Test. When the game starts, if you press the down arrow, our player moves down.
* Ok, so the other directions are similar and let’s just finish them quickly. So, when up arrow is pressed, change y by 2; when left arrow is pressed, this time, change x by -2; and finally, when right arrow is pressed, change x by 2.
* Test. Now we can control our player to move in any direction, and you can hold the key down to the keep the player moving in one direction. Cool!
* Problem: But if you watch more closely, when we hold an arrow key down, the player appears to move, but then stops for bit and starts moving again. This is the same for all four directions. You can play with it to better understand what I mean. There is always this small lag when we hold the key down. In fact, this is a known issue in Scratch: the “when key pressed” block is only good if you press the key once at a time. For example, in lesson “[Turtle Crossing](../Level1%2051869bb3a8274fd0910ceb115e2e8daf/6%20Turtle%20Crossing%202cdafea6327c41f4872354ffed1c4938.md)”, we press the arrow key once to change direction and release it right away, we never hold the key down. But here, we are holding the key down to expect the player to move continuously, and in such case, the “when key pressed” block is going to cause this small lag that we have experienced. So what else can we do then?
* Solution: Well, there is actually another way in Scratch to check if a key is pressed or not. Take a look at the Sensing category and see if you can find any useful block? Yes, it’s the “key pressed” diamond block. Just like the “when key pressed” hat block, you can select a lot of different keys from the dropdown list, including the four arrow keys. Let’s pick the “down arrow” Now, since this is a diamond block, meaning it’s a condition that can be used to make decision on whether a key is pressed or not. And what block do we use to make decision? Yes, we can use the “if then” or “if then else” blocks. Here, we just need an “if then” block and let’s use the “key pressed” diamond block as its condition. If the down arrow key is pressed, we change y by -2. Ok, this code here will not just run, remember all scripts in Scratch need to start with a hat block right? So to run this “if then” block, we need a hat block too! What hat block do you think we can use here? Ok, let me give you a hint: we want to control the player when the game starts to run right? How do we know when the game starts to run? Yes, when we receive the “Run” message. Remember, we broadcast a “Run” message after setting things up, right? And how do you receive a broadcasted message? Yes, we use the “When I receive” hat block. So once we receive the “Run” message, we then check if down arrow is pressed and if so we move the player down.
* Test. 
* Problem: Ok, now, things seem to get even worse! When we press the down arrow, nothing happens, the player does not move at all! What is going on here? How do we manage to make things worse?
* Solution: Now it’s recap time again! In lesson “[Let’s Paint](8%20Let%E2%80%99s%20Paint!%20bdc3bc2a4a914ce985e89ca64c065fdd.md)”, do you still remember how we make the pencil follow the mouse pointer? Yes, we use the “go to mouse pointer” block. Ok, you might be asking, what does that have to do with our problem here? Well, we not only use the “go to mouse pointer” block, but also put it inside a “forever” loop, right? And why did we do that? Because we want the pencil to keep going to the mouse pointer again and again as long as the program is still running. If we don’t use a forever loop, it will just go to the mouse pointer once and that’s it, it will not follow it after that. Ok, back to our player here: How many times do you think we need to check if the arrow key is pressed? Once, twice or many more? Yes, we want to check it for as long as the program is running. And how many times do you think we are checking now? Yes, once, only once when we receive the “Run” message. So if we press it later, it is not going to check it again and no wonder why the player is not moving at all! Ok, this is a slight disadvantage compared to using the “When key pressed” hat block, but if all we want is just to keep checking the key press again and again, the solution is simple and we already know how, right? Anyone? Yes, just put the “if then” block inside a “forever” loop.
* Test. Now as we press and hold the “down arrow” key, the players moves down, and more importantly, we do not experience the small lag anymore, as soon as you hold the key down, the players moves right away, so smooth! Perfect!
* Ok, so now we can move the player down, can you complete the code for the other three directions? Let’s have a 5 min break and see if you can figure this out!
* OK, time’s up! Let’s take a look together. So there are two ways of doing it: the first one is to just to add three more “if then” blocks in the forever loop for the other three directions to create rather long script. No problem with that. But I always want to have shorter scripts, because I think it makes things clearer. So I would just add three more “When I receive Run” hat blocks, and under each one, I will add an “if then” block for a particular arrow key. So let’s just quickly finish that. It’s a personal preference, and you get to decide which one to choose and both are right.
* Test. Ok, now we can use all four arrow keys to move the player freely on the stage, no lag and super smooth. Nice! |
| Player (wall collision) | * Ok, so the player can move freely on the map now. But there is an obvious problem: it can go through all the walls now! That’s certainly not in the plan and we should make it stop when it hits a wall. Making a sprite stop when it bumps into something is a very common thing do in a lot of games so let’s see how this can be done!
* To solve the problem, we first need to detect when the player touches the wall. Well, this is not very different from detecting when the turtle touches the ocean in lesson “[Turtle Crossing](../Level1%2051869bb3a8274fd0910ceb115e2e8daf/6%20Turtle%20Crossing%202cdafea6327c41f4872354ffed1c4938.md)”, right? And what did we do in that lesson? Yes, we use the “touching color” block! So, let’s see what we should do when the right arrow key is pressed. After we change x by 2, or move the player 2 steps to the right, we can use an “if then” block to check if it is touching the wall. The condition is just the “touching color” diamond, and we use its color picker to select to color of the wall, which is some greyish color. To test this, let’s just add a ”say” block in the if to say “I’m touching wall”
* Test. Now, if we move the player to the right until it bumps into the wall, it says “I’m touching the wall” but then just keeps going through it as before. 
* OK, next comes the all important question: what should we do if the player is touching the color or the wall? Of course, just saying “I’m touching the wall!” is not going to help, so let’s delete the “say” block. Ok, let’s zoom right in and see what really happens when the player bumps into a wall. We have the player on the left and the wall on the right. Then the player moves towards right and get closer and closer to the wall. Now suppose the player is very close to the wall but still not touching it. Ok, let’s say we are still pressing the right arrow key down, so the player moves again to the right in 2 steps. Now, this time, it is touching the wall and our if condition becomes true. But since we are not doing anything in the “if then” block, it just keeps moving to the right. Now, what we want to do is to tell the player “hold on, you are now touching the wall, go back to where you were” So where was the player before it touches the wall? Yes, it’s right here, very close to the wall, but still not touching it. If we want the player to go back to this position, what can we do? Let me ask you a different question: how dose the player go from here where it is not touching the wall to here where it is touching it? Yes, we move it to the right two steps using this “change x by” block. So to move it back, all we need to do is just to move it to the left two steps and that should move it back to where it was before, right? To move it to the left two steps when it touches the wall, all we need to do is just to add a “change x by -2” block inside the “if then” block. Essentially, if these two “change x by” blocks cancel each other out, and it is as if the player has not moved at all. 
* Test. Now if we move the player to the right and bump into the wall, see, even if I keep pressing the right arrow key, the player is not moving forward and just stays still. Perfect!
* Ok, I have to admit that even though it looks like the player has stopped just before it hits the wall, it is not actually sitting still if we keep holding down the right arrow key. Instead, every time this forever loop iterates, because the right arrow key is pressed down, the player first moves right 2 steps, finds out that it touches the wall, then it backs out by moving 2 steps left. And the next time round, if the right arrow key is still down, then it repeats this. And as long as the right arrow key is pressed down, this happens again and again. The reason it looks like the player has stopped is because the computer executes the code really fast, so we don’t actually see the player repeatedly doing the left/right movement.
* Ok, the player can still go through walls when moving in the other three directions, so let’s have another five minute break and I will let you complete the code for them.
* Ok, time’s up, let’s do it together: so ….. |
| Portal (winning) | * Now we can move the player, let’s add a portal. The idea is that once the player gets to the portal, he/she can escape the room, woohoo!
* Let’s first add a Portal sprite by selecting the “Portal” image from the Resources folder. Move it to the lower right corner. When the portal receives “Setup” message, go to its current position.
* Ok, now let’s think about what the portal should be doing once the game starts to run. Remember, the player is telling everybody to run by broadcasting the “Run” message. So in portal, let’s receives that message by adding a “When I receive Run” hat block. The player wins the game when he/she touches the portal, or from the portal’s perspective, when it touches the player. So take a minute and imagine yourself being the portal, when the game starts, the player is far away in the upper left corner, so you have nothing to do but just wait. You wait and wait, UNTIL finally the player is here and you touches it. In cases like this, it would nice if we can make a sprite just sit there, do nothing, and wait until something happens. Well, we are luck, because Scratch does give us such a block, and if you go to the Control category, guess what this block is called? Yes, “wait until”! Now, this block has a diamond shape hole, meaning it wait until something happens, or more formally, until some condition becomes true. And what are we wait for here? Yes, we wait until it touches the player. So we can add the diamond block “touching Player” as the condition to check and wait for. So what this whole script is doing is that when the portal receives the “Run” message, it just waits until it touches the player, and once it does touch the player, it then finishes the wait and continues with the rest of the script. Of course, we don’t have anything yet, which is something we are going look at next.
* Now the question becomes what should we do if the portal is touching the player, in other words, if the player wins? Well, we want to add some graphic effects to the player to make it fade slowly, as if he/she escapes the room by entering the portal. But of course we cannot do it here in the portal’s code, this has to be done in the Player sprite. So how does the player know he/she wins? Simple, we can just send the player a message from the portal! So let’s broadcast a “Win” message if the portal touches the player.  |
| Player (Winning) | * Ok, back to the Player sprite, let’s first add a “when I receive Win” hat block for it to receive the message sent from portal. 
* When we win, let’s first play some winning sound. Select the “Sounds” tab, and delete the default pop sound. Go into Scratch’s sound library and search for “Win”. Click that and it gets added to the sprite. Now back to the code, when the player receives the “Win” message, play the “Win” sound using the “start sound” block in the Sound category.
* Next, let’s add the fade effect. In lesson “[Ghost Buster](../Level1%2051869bb3a8274fd0910ceb115e2e8daf/4%20Ghost%20Buster%2031810f72b21c4323bd4fe2bb5d980a58.md)”, we have seen how to fade the ghost, right? All we need to do is to increase its ghost effect slowly until it is completely invisible.
* So let’s add a repeat loop, now the idea is to loop a number of times, and each time we increase the player’s ghost effect by some amount, and then after this loop, its ghost effect reaches 100, meaning it cannot be seen anymore. So for example, I can repeat 10 times and each time increase the ghost effect by 10 using the “change effect” block. Remember, you can change different effects for a sprite, and here we will select “ghost” and type in 10 in bubble here. Because we repeat 10 times and increase the effect by 10 each time, so in total we increase the effect by 10x10 which is 100. So after this loop, the player should be invisible.
* Test. Now move the player towards to portal, and they touch each other, now we can hear the winning sound and at the same time the player fades away nicely. Cool.
* Problem: OK, I want to you look closely at the four scripts what control the player’s movement: after the play wins and fades away, all these four scripts are still highlight, right? What does it mean is a script is highlighted? Yes, it means it is still running. This means, we can still move the player even after he/she has reaches the portal. This is not obvious only because we make it invisible. So let’s just stop running the change effect script temporarily by detaching it from the “When I receive Win” hat block. So it will not disappear after winning.
* Test. Now watch carefully, once the player touches the portal, we can still move it around. This is just because the four scripts that control its movement are still running, so of course we can still move the player. But what we want instead is, as soon as the game finishes, either because of winning or losing, we should not be able to move the player anymore. So we need to fix this.
* Solution: Ok, we have seen similar situation before, for example, in lesson “[Turtle Crossing](../Level1%2051869bb3a8274fd0910ceb115e2e8daf/6%20Turtle%20Crossing%202cdafea6327c41f4872354ffed1c4938.md)”, when a crab catches the turtle, everything stops and we did so by using the “stop all” block. So a simple solution is just to use this block again at the end.
* Test. Now, let’s move the player to the portal, it disappears and the winning sound starts to play. 
* Problem: But then something strange happened: the sound was cut off before it could finish and the player shows up again. What is going on here? Ok, first, what we need to keeping in mind is that “stop all” is very powerful: it stops ALL scripts in ALL sprites, I mean ALL, each and every script in your project. It’s like a nuclear bomb that takes out everything blindly. Now, this might be useful in some cases where you just want every running script in the game to stop all at once. In this case, it means the script that it belongs to, this one here, will also stops right away. Remember it stops each and every single script in your program. But the problem here is, if we take a look at the “Win” sound in the sounds tab, you can see that it lasts for about 2 seconds, right? Now back to the code, when you start playing the winning sound, it takes 2 seconds to finish. Remember, unlike the “play sound until done” block, which waits until the sound has finished playing before continuing with the rest of the code, the “start sound” blocks starts the sound and continues with the rest right away. So the sound will be playing alongside with the repeat loop. But because this loop is only going to take a fraction of a second, and maybe even faster than that, then the code reaches the “stop all” block, the sound is still playing. Unfortunately, the “stop all” block will now nuke everything, including this script which is still playing the sound. As a result, the sound will get cut off before it finishes, and that’s exactly what happened here. Also when we use “stop all”, all graphical effects will be reset, so the ghost effect of the player will be reset to 0 and that’s why it shows up again. 
* Solution: So it seems that what we want is something that stops every other script in this sprite except this one where the sound is played. Fortunately, if you open dropdown list of this stop block, you will see two other options: the first one is “this script” meaning the script that this block belongs to. But because this is not the script that we want to stop, so we will not select it. The second one is this “other scripts in sprite”. Well, its name says all, it stops other scripts, except this one, in this sprite. And it looks like what we need here, so let’s select that. 
* Test. Now when the player touches the portal, we hear the entire winning sound and at the same time all other scripts in this sprite are stopped. And because we are not using “stop all” anymore, the ghost effect of the player stays and it remains invisible. Perfect! |
| Laser Gate (kill player) | * OK, as it stands now, this escape room is just way TOO simple. There are no challenges, no enemies and no obstacles to avoid at all. So let’s spice things up a little bit!
* First let’s add some laser gates to make it difficult for our player to go from room to room. Add a laser sprite by choosing the “laser gate” image from the Resources folder. Adjust its size and orientation in the paint editor and name it “laser gate”. We will place it here to prevent the player from leaving this room. When it receives the “setup message”, go to its current position.
* The idea is that if the player touches the laser gate, he/she gets burned and loses the game, because you know, laser is extremely hot! 
* Ok, so just like the portal sprite, when the gram starts to run, the laser gate waits until it touches the player. When that happens, unlike the winning case where the portal broadcasts a “Win” message to the player, we broadcast a “Lose” message instead to the player.  |
| Player (Losing) | * Ok, back to the Player sprite again, let’s first add a “when I receive Lose” hat block for it to receive the message sent from the laser gate. 
* When we Lose, let’s first play some losing sound. Select the “Sounds” tab, go into Scratch’s sound library and search for “Lose”. Click that and it gets added to the sprite. Now back to the code, when the player receives the “Lose” message, play the “Lose” sound using the “start sound” block in the Sound category.
* To make it more apparent that we have lost the game, let’s add another costume to the player sprite by selecting the “player lose” image from the Resource folder. Then, after the playing the Lose sound, let’s switch its costume to “player lose”
* Test. Ok, the player moves down and touches the laser gate. BOOM, we hear the losing sound and it changes to the losing costume. 
* Problem: But if we hold down the arrow key, it can still move round. Again, this is because we have not stopped the scripts that allow us to control the player’s movement. 
* Solution: Just like in the winning case, all we need to do is to stop other scripts in sprite.
* Test. Player touches the laser gate, we hear the losing sound and we are no longer able to move it. Perfect! 
* Now, because we change the player’s costume when lose, we need to reset it to the normal player costume when setting things up. |
| Portal (still running when losing) | * Problem: Now when player touches laser gate, it is game over and everything should stop, right? But take a look at the green flag above the stage, see, looks like it is still active, meaning somewhere some script is still running. But what can that be? Let’s take a look at each sprite. The player, no script is highlighted, so it can’t be here. Next, the portal, Aha, look what I have found, this script is highlighted, meaning it is still running! Why? Well, remember it waits until the player touches it. But the player was destroyed long before it can reach the portal, so the portal just gets stuck and waits here forever! 
* Solution: So what we need to do is when we lose, we want to stop this script too! How do we know when we lose? Yes, when we get the “Lose” message, so let’s add a “When I received Lose” hat block, and when this happens, how do we stop this script here? Yes, we use the “stop other scripts in sprite” block.
* Test. Now, see, as soon as the player touches the laser gate, this script is no longer highlighted and the green flag is not active anymore, meaning the game has truly been stopped and no script is running. Cool. |
| Computer | * Ok, right now our player is trapped inside the room. There needs to be a way to get out! For that, our player needs to answer a question and the laser door will be opened if he/she gets it right. So who is going to ask the question? Well, we will be adding a computer for that.
* Add a computer sprite by selecting the “computer” image from the Resources folder. When it receives “Setup” message, go to its current position. 
* When the game starts to run, like the portal and the laser gate, the computer is just going to sit there and wait until it touches the player. And when that happens, it’s gonna ask a question. Now, you might choose any question you want to challenge the player. Here, I’m gonna ask some questions about Scratch: add an “ask and wait” block after the “wait until”, for the question, I’m gonna type in “What is the mascot of Scratch?” Well, do you know what the mascot is? Yes, it’s the cat! So let’s check the answer next. Add an “if then else” block, if the answer given by the player is “cat”, then the computer is gonna reply “Good job!” using a say block, else it’s gonna say “Oops! Try again.”
* Test. Ok, we walk to the computer, it asks “What is the mascot of Scratch?” and let’s type in “cat” and it says “good job!” Now let’s run again, this time we answer “dog” and the computer says “Oops! Try again.” Cool!
* Problem: Ok, when you test your program, do not just test the happy case, the case that you think how a player should play your game. I can guarantee you that a player will never play the way you want them to play, they would do all sorts of crazy or stupid things to your game. And your job is to make sure that, even if they do crazy or stupid things, your program can still handle nicely. So here, one thing the player can do is just to skip the computer part and go straight to the laser gate, because… well… they are just crazy. Now, watch what happen. Ok, we hear the losing sound and we can no longer move the player, so the game ends. Or is it? Well, I can still see the green flag activated, and as we have discussed before, this means some script somewhere is still running. Which one can that be? Well let’s check, no the Player sprite, not the Portal sprite, not the Laser Gate sprite and ah, we found the culprit, it’s the computer sprite, see, this whole script is highlighted. And why is it still running? Well, the reason is not that much different from that of the Portal case, because it is still waiting the player to come and touch it. But you know what, the player just ran into the laser gate and got killed, so he/she might never come, SAD. 
* Solution: just as in the Portal case, all we need to do is make sure this script stops running when the computer sprite receives a “Lose” message. So when I receive Lose message, just stop other scripts in this sprite.
* Test. Now, if we go crazy and decide to kill ourselves by running straight into the laser gate, the game ends and this time, this computer script is no longer running. And the green flag is not active this time. Perfect!
* Ok, let’s be a good citizen and try our best to answer the question correctly. But right now, even if we’ve done so, the gate remains closed and our player is still trapped inside. So let’s work on that next. If the answer is correct, the computer needs to tell the laser gate to open itself. Well, we have seen this a million times by now, to tell another sprite to do something, we broadcast a message. And in this case, the message might be something like “Open the first laser gate”. The reason it is the “first” is because we are going to be adding more laser gates later on. |
| Laser Gate (open) | * Now back to the laser gate, when it receives “Open the first laser gate” message, we just hide it. As always, if you hide a sprite, make sure that you show it at the beginning when things are setting up.
* Test. Now when we answer “cat”, the computer says good job and the gate is gone. 
* Problem: Now we can see that the Run script of the laser gate is still running as it’s been highlighted. We have seen this before when the portal sprite is still waiting for the player to touch even after the game is over. So same here, when the gate is open and gone, it should not be waiting for the player anymore. 
* Solution: So apart from hiding it, we should also stop other scripts in this sprite when receiving message “Open the first laser gate”.
* Test. Answer “cat” and yes, the run script stops. Nice! |
| Computer (retry) | * Ok, everything is good as long as we answer the question correctly: the gate opens and we can move out to continue the adventure. 
* Problem: But what happen if our answer is incorrectly? Well, the computer says “Oops! Try again!” Ok, fair enough, I guess we will just try again, right? But look, now, if I move the player to the computer and touch it again, nothing happens, looks like the computer is just dead and not responding anymore! So here our worse nightmare: our player gets trapped in the room FOREVER! We can never get out!
* Solution: Well if we want to allow the player to answer this question again and again until he get it right, we could first try to put everything here into a forever loop.
* Test. Now, if I answer “dog”, which is clearly the wrong answer, it says “Oops! Try again!” Then immediately, it asks the question again. That’s good.
* Problem: But what if I answer “cat” this time, well, it says “good job!” and the gate opens, so far so good. Then, ouch! The computer asks the same question again. That’s a bit weird. Going back to our code, see if you can explain what just happened. Yes, it’s because of the forever loop. Now, if we answer correctly, it says “good job” and broadcasts the message. But then it starts loop again from the beginning, so it waits until it touches the player, and because we have not moved the player, so they are still touching each other, and therefore I goes to the next block which asks “What is the mascot of Scratch?” And if I answer “cat” again, the whole process will just repeat again.
* Solution: We add the forever loop for the case when the player gives a wrong answer, so that it can ask the question again. But in the case then the player gives a correct answer, we do not want to loop again, or in other words, we want this forever loop to stop. But how? Well, when you hear the word “stop”, your first reaction should be pull out the “stop” block. Now, as we have seen before, there are three options in the “stop” block and we have already seen and used two of them: stop all and stop other scripts in sprite. Do we want to stop all? Clearly not, we don’t want to end the game, right? Do we want to stop other scripts in this sprite? Well, there is just one other script in this sprite that is the setup script, clearly there is no need to stop it because it is already stopped when the setup is finished. So, what we actually want is to stop this Run script that contains the forever loop, right? Once the forever loop is stopped, then no more questions will be asked. So how do we stop THIS script? Well, what is the third option for the “stop” block? Yes, “this script”? Hmmm…that looks promising! So let’s stop this script if the answer is “cat”.
* Test. Let’s repeat the test: we first answer “dog”, it’s wrong, so the computer asks us again, and this time we answer “cat”, and the gate opens. What is more important this time is that the computer never asks the question again. Perfect! |
| Two more computers and two more laser gates | * Ok, when we design the escape room, we planned to have three computers asking three different questions. Every time you get one correct, it opens the next laser gate. We have just added one computer and one laser gate, so two more to go!
* Duplicate the computer sprite and move it to the bottom of the stage. In its code, change the x and y values to match its current position. Ok, so there are a few other places in the code that we need to change. First, we are going to choose a different Scratch question. This time let’s ask “How many motion blocks are there in Scratch?” By the way, do you know how many there are? Well, I don’t know, so let’s count. 18 in total, so let’s check if answer is 18. If the player answers correctly, we broadcast a new message to open the second laser gate: add a new message “Open the second laser gate” OK, these are all the changes we need to make for the second computer. 
* Now, we still don’t have the second gate. So let’s duplicate the current Laser Gate sprite. Change its size and orientation in the Paint editor and move it up here. For this second laser gate, all we need to change is just it’s position and the rest will be the same. 
* Test. OK, we answer “cat” to open the first laser gate, and then move to the second computer and answer “18” to open the second laser gate. 
* Ok, finally we need to add a third computer and third laser gate. The computer will be here in the second room and the laser gate will be just before the portal. So, let take a 5 min break to see if you can finish that by yourself.
* Ok. Time’s up! Let’s take a look together. Again, we first duplicate the computer sprite. Move it into the second room and change the x and y values in the “go to” block to match its current position. Ok, let’s add a third question about Scratch? What do you want to ask? Give it a try! OK, let’s ask “What extension do you use to draw in Scratch?” By now we all know that it’s the Pen extension, so let’s check if the answer is “Pen”, if so, we broadcast another new message “Open the third laser gate”.
* Next duplicate the second Laser Gate sprite. Change its size in the Paint editor and move it down here. Similar to the second laser gate, all we need to change is just it’s position and the rest will be the same. 
* Test. OK, we answer “cat” to open the first laser gate, and then move to the second computer and answer “18” to open the second laser gate, then move to the third computer and answer “Pen” to open the third laser gate. And finally, we can get to the portal!
* Problem: Ok, so we have just tested the happy case when we answered all the questions correctly and eventually reach portal. Now let’s again go crazy and run straight to the first laser gate when the program starts. OK, it seems the game ends…or…is it? Again, it looks like the green flag is still active so some script somewhere is still running. Let’s find out. Not the second or the third computer, but take a look at the second and the third laser gate, have you seen what is still running after the player has lost? Yes, the wait until block again!
* Solution: And by now, the solution shouldn’t be new to you any more: when it receives the ”Lose” message, stop other scripts in the sprite. We do the same for both laser gates.
* Test. Now, runs to the first laser gate again, the game ends, and this time, it truly ends. The green flag is not active and no scripts is still running. Perfect! |
| Enemies | * Now we have set up all the challenges of our player to reach the portal and escape the room. But the game still feels a little bit too easy, so let’s add some enemies!
* For this game, I’m going to add to enemies, one guarding each room. They are just going to move back and forth in front of the gate. If the player touches one of them, the game is over. 
* Let’s first add one enemy by selecting the images “enemy1” from the Resources folder. We move enemy1 in front of the first laser gate. When setting up, make it go to its current position. Once the game starts to run we want it to move from side to side forever. So add a “forever” block first. Now there are many different ways to move it from side to side. You could use the move block, change x block for the glide block. Here I will use the glide block. Initially, the enemy is on the right, so we want to move it to the left, roughly here. Now this position should have the same y value as its initial position, and the x value should be what is showing here. Let’s fill the “glide” block with these two numbers.
* Test, cool, it moves to the left. But the speed seems a bit too fast, so let’s slow it down by changing the duration in the glide block to 2 seconds. Test again and it looks better.
* Now, after it has reaches the left end, we want it to move back to the right. That’s easy enough, just add another glide block to move it back to the initial position, again in 2 seconds.
* Test. Cool, now it moves from side to side. Nice!
* Ok, we next want to get our player out and see that happen when it touches the enemy. But right now, we have to answer the first question each time so that the gate can open for us the get out. This becomes quite inconvenient when we want to test the enemy. So very often when you code, to make it easy to test one part, it is often helpful to temporarily disable another part. In this case, we want to disable the Laser Gate. So which script in the Laser gate sprite do you think is preventing our player from getting out? Yes, this one, because when the player touches it, it broadcasts a “Lose” message and that just kills the game. So all we need to do is just detach the all the code from the hat block temporarily, so nothing is going to happen when the two touch each other.
* Test. Now, without answering any question, we can just move pass the laser gate without any problem and check what happens when we touch the enemy. This just makes testing the enemy so much easier. And now we can see nothing happens when the player touches the enemy, and this is something we are going to look at next.
* Ok, so in the case of portal and laser gate, they just sit there doing nothing except waiting until touching the player and once the two touches each other, a “Lose” message is broadcasted. Can we do the same for the enemy? In the Run script, if we want to wait until and the broadcast, where exactly should we put the blocks?  How about before the forever loop? Let’s try!
* Test. Now when the program starts, the enemy does not move at all! Why? Well because it’s waiting for the player to touch it! And before that happens, it gets stuck in this “wait until” block and never gets the chance to run the rest, including the forever loop.
* Ok, how about after it? Well, remember a forever loop never finishes, meaning no code will ever be run after it. And Scratch makes this rule clear enough by not even allowing any block to be attached after the forever loop. See, you can never attach the two blocks after the forever, it is simply just not possible. Well, how about inside the forever loop? What does that even mean? Do you want to wait again and again for the player to touch? I don’t think so. So there doesn’t seem to be a good place to add these two blocks in the Run script. What can we do then?
* So far, all sprites who receive the “Run” message always use one Run script to handle it, whether it’s Portal, laser gate or the computer. But there is no reason why a sprite can’t use more than one Run script to do different things when receiving the “Run” message. So we already have one Run script that moves the enemy from side to side. We can have another Run script that waits until it touches the player. And if so, broadcast a “Lose” message. Now when a “Run” message is sent and received, both scripts will start to run at the same time, and no one is interfering with the other.
* Test. Now, when the enemy touches the player, we hear the losing sound, and the player cannot be moved anymore. 
* Problem: But the problem here is the enemy is still moving from side to side. Why? Take a look at the enemy’s code! Can you see what script is still running? Yes, this Run script!
* Solution: So just like in portal, laser gate and computer, when the enemy receives “Lose” message, it stops other scripts in this sprite.
* Test. Now when the touch each other, the player can not move anymore and the enemy also stops moving. Perfect!
* Ok, let’s add a second enemy. Duplicate Enemy1. We would like to use a different costume for enemy2, so open the costume tab, delete its current costume, go to the Resources folder and select image “enemy2”. Move it just in front of the second laser gate. This time we want it to move from to bottom. 
* Ok, now task for you: can you figure out what code we need to change for enemy2 and make those changes! Go ahead!
* Ok, time’s up! Let’s take a look. So the first place we need to change is this ”go to” block because enemy2 is starting from a different position. So let’s fill in x and y with their current values. Next we need to change x and y values of the two glide blocks too. So we want enemy2 to move to roughly here before it moves back up. And let’s use its current y value to fill in the first glide block and the x value stay the same. For the second glide block, because it moves the sprite back to its initial place, so its x and y values are the same as those in the “go to” block.
* Test. Nice, now we have two enemies patrolling, make it more difficult for our player to get in or out of the rooms. Let’s then move the player to the enemy2 and see what happens when they touches each other. Yep, the game ends and everybody stops, no one is moving. Perfect! |
| Revolving Gate | * Ok, now leaving the first room and entering the second room is more difficult. But I think it is still too easy to get to the second computer at the bottom. So let’s add some challenge to that too!
* Let’s first add a revolving gate. Add a new sprite by selecting the “revolving gate” image from the Resources folder. Place it roughly here. When the “Setup” message is received, go to its current position. All the usual things. 
* Now we want the gate to keep turn forever around its center here. The player needs to be careful not touch it when trying to get to the second computer. If I remember correctly, I think I have seen a very similar revolving gate before? Do you? Yes, it is in the lesson “[Race to the Island](10%20Race%20to%20the%20Island%208d244dc379844c1e85601f7a2302e706.md)” where we have an almost identical gate. So to make it turn forever when receiving the “Run” message, we just need use the turn block to keep it turning for a small degree, for example 2 degrees, forever.
* Test. Yep, the gate starts turning forever.
* Now, we are facing with the same problem as that in the enemy case, we need to check if the gate is touching the enemy and if so end the game the stop the gate from rotating. Now, another challenge for you, based on what we have learnt before, can you complete the reset of the code?
* OK. time’s up! Let’s see. To check whether the gate is touching the player, just like the enemy, we need a new Run script, and in that, we wait until it touches player and then broadcasts the “Lose” message. And to stop it from rotating when the game ends, when it receves the “Lose” message, simply stop other scripts in this sprite.
* Test. We move out of the room, and oops, we touch the revolving gate. Yep, the game ends and everybody stops. Perfect! |
| Enable first laser gate again | * Ok, so we are pretty much all done! Before you open the champagne and celebrate, there is just one tiny thing we need to fix: remember we disabled the first laser gate to make testing the enemy easier? And that’s why we can now move out the first room without even answering any questions! So it’s time to enable the laser gate again, and this should be fairly easy, we just need to attach the code here back to the “When I receive Run” hat block.
* Test. Yep, this time, we will die if we head straight to the laser gate. Perfect! |

### Further Exploration

- What if the answer contains the key word
- Change the questions
- Add a count down
- Add other levels